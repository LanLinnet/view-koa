/*
 * client3d.js - v0.3.10
 * Compiled Fri Aug 27 2021 13:52:17 GMT+0800 (中国标准时间)
 * Copyright (c) 2021 www.hightopo.com
 */

var hteditor3d=function(){"use strict";function M(M){return/^scenes/.test(M)}function Q(M){return/^models/.test(M)}function b(M){return/^symbols/.test(M)}function Y(M){return/^assets/.test(M)}function I(M){return/\.obj$/i.test(M)}function i(M){return/\.mtl$/i.test(M)}function o(M){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(M)}function T(M){return/\.json$/i.test(M)}function C(M){return M&&"object"==typeof M}function R(M){return"string"==typeof M||M instanceof String}function t(M){return ht.Default.getImageMap()[M]?(delete ht.Default.getImageMap()[M],!0):ht.Default.getCompTypeMap()[M]?(delete ht.Default.getCompTypeMap()[M],!0):(void 0!==ht.Default.getShape3dModel(M)&&ht.Default.setShape3dModel(M,void 0),!1)}function L(M,Q,b,Y){var I=new ht.Tab;return I.setName(Q),I.setView(b),M.getTabModel().add(I),Y&&M.getTabModel().sm().ss(I),I}function G(M){var Q=new RegExp("(^|&)"+M+"=([^&]*)(&|$)"),b=window.location.search.substr(1).match(Q);return null!=b?decodeURIComponent(b[2]):null}function X(M,Q,b){if(M instanceof Array)for(var Y=0,I=M.length;Y<I;Y++)X(M[Y],Q,b);else if(M instanceof Object)for(var i in M)if(M.hasOwnProperty(i)){var o=M[i];if(!C(o))continue;if(R(o.func)&&F.test(o.func)){var T=o.func.slice(5);Q&&void 0===Q[T]&&(Q[T]=i),b&&void 0===b[T]&&(b[T]=o.value)}else X(o,Q,b)}}var p=hteditor;p.getString;p.createTablePane=function(){var M=new ht.widget.TablePane;return M.getView().style.border=hteditor.config.color_line+" solid 1px",M};var s=function(){},F=/^attr@/,P=ht.Default,_=p.config;!function(M){for(var Q in M)void 0===_[Q]&&(_[Q]=M[Q])}({texureImage3D:!0,modelDialogClasses:{},objViewSize:{width:800,height:500},imageViewSize:{width:600,height:500},sceneGridEnabled:!0,sceneGridBlockCount:50,sceneGridBlockSize:40,sceneGridColor:"rgb(191, 191, 191)",sceneEye:P.graph3dViewEye,sceneCenter:P.graph3dViewCenter,sceneNear:P.graph3dViewNear,sceneFar:P.graph3dViewFar,sceneBloom:!1,sceneBloomStrength:1.5,sceneBloomThreshold:.55,sceneBloomRadius:.4,sceneDof:!1,sceneDofAperture:.025,sceneDofImage:null,sceneHighlightMode:"style",sceneHighlightColor:ht.Style["highlight.color"],sceneHighlightWidth:ht.Style["highlight.width"],sceneDashEnable:!1,sceneHeadlightEnable:!P.graph3dViewHeadlightDisabled,sceneHeadlightRange:P.graph3dViewHeadlightRange,sceneHeadlightColor:"rgb(255,255,255)",sceneHeadlightIntensity:P.graph3dViewHeadlightIntensity,sceneHeadlightAmbientIntensity:P.graph3dViewHeadlightAmbientIntensity,sceneFogEnable:!P.graph3dViewFogDisabled,sceneFogColor:P.graph3dViewFogColor,sceneFogNear:P.graph3dViewFogNear,sceneFogFar:P.graph3dViewFogFar,sceneBatchBrightnessDisabled:P.graph3dViewBatchBrightnessDisabled,sceneBatchBlendDisabled:P.graph3dViewBatchBlendDisabled,sceneBatchColorDisabled:P.graph3dViewBatchColorDisabled,sceneShadowEnabled:!1,sceneShadowDegreeX:ht.Default.graph3dViewShadowDegreeX,sceneShadowDegreeZ:ht.Default.graph3dViewShadowDegreeZ,sceneShadowIntensity:ht.Default.graph3dViewShadowIntensity,sceneShadowQuality:ht.Default.graph3dViewShadowQuality,sceneShadowType:ht.Default.graph3dViewShadowType,sceneShadowRadius:ht.Default.graph3dViewShadowRadius,sceneShadowBias:ht.Default.graph3dViewShadowBias,sceneEditHelperDisabled:!1,sceneOrthographic:!1}),["TitleScenes"].forEach(function(M){null==_.expandedTitles[M]&&(_.expandedTitles[M]=!0)});ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("editor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("editor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("editor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("editor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]}),ht.Default.setImage("editor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.sphere",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("editor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("editor.scene.cone",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[3,10,10,3.48659]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[3,12,8,2,13,12]}]}),ht.Default.setImage("editor.scene.torus",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,4,14,10]},{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,2,12,10]}]}),ht.Default.setImage("editor.scene.triangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2.09838,2,12,10]}]}),ht.Default.setImage("editor.scene.rightTriangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.09838,2,10.90162,10]}]}),ht.Default.setImage("editor.scene.parallelogram",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,5,14,8]},{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1,2,13,8]}]}),ht.Default.setImage("editor.scene.trapezoid",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[.90479,6,14,8]},{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.40479,2.5,13,9]}]}),ht.Default.setImage("editor.scene.rect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.roundRect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.star",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.59838,2,13,13]},{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,1,12,12]}]}),ht.Default.setImage("editor.scene.box",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",opacity:.4,rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.scene.billboard",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[8,13,6,10,3,10,3,3,13,3,13,10,10,10,8,13]}]}),ht.Default.setImage("editor.scene.plane",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[1.5,12.5,5.5,7.5,14.5,7.5,10.5,12.5,1.5,12.5]}]});var S=(function(){function M(M){this.value=M}function Q(Q){function b(M,Q){return new Promise(function(b,I){var T={key:M,arg:Q,resolve:b,reject:I,next:null};o?o=o.next=T:(i=o=T,Y(M,Q))})}function Y(b,i){try{var o=Q[b](i),T=o.value;T instanceof M?Promise.resolve(T.value).then(function(M){Y("next",M)},function(M){Y("throw",M)}):I(o.done?"return":"normal",o.value)}catch(M){I("throw",M)}}function I(M,Q){switch(M){case"return":i.resolve({value:Q,done:!0});break;case"throw":i.reject(Q);break;default:i.resolve({value:Q,done:!1})}i=i.next,i?Y(i.key,i.arg):o=null}var i,o;this._invoke=b,"function"!=typeof Q.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(Q.prototype[Symbol.asyncIterator]=function(){return this}),Q.prototype.next=function(M){return this._invoke("next",M)},Q.prototype.throw=function(M){return this._invoke("throw",M)},Q.prototype.return=function(M){return this._invoke("return",M)}}(),function(M,Q){if(!(M instanceof Q))throw new TypeError("Cannot call a class as a function")}),Z=function(){function M(M,Q){for(var b=0;b<Q.length;b++){var Y=Q[b];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(M,Y.key,Y)}}return function(Q,b,Y){return b&&M(Q.prototype,b),Y&&M(Q,Y),Q}}(),f=function(M,Q){if("function"!=typeof Q&&null!==Q)throw new TypeError("Super expression must either be null or a function, not "+typeof Q);M.prototype=Object.create(Q&&Q.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}),Q&&(Object.setPrototypeOf?Object.setPrototypeOf(M,Q):M.__proto__=Q)},c=function(M,Q){if(!M)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!Q||"object"!=typeof Q&&"function"!=typeof Q?M:Q},z=function(){function M(Q,b){var Y=this;S(this,M),this.handler=Q,this.editor=b,this.cookie=0,this.callbacks={},this.cmds={};var I=hteditor.config.host||window.location.hostname,i=hteditor.config.port||window.location.port,o=window.location.protocol+"//"+I+":"+i;this.socket=io.connect(o),this.socket.on("connect",function(){Y.handler({type:"connected",message:o})}),this.socket.on("disconnect",function(){Y.handler({type:"disconnected",message:o})}),this.socket.on("fileChanged",function(M){Y.handler({type:"fileChanged",path:M.path,event:M.event})}),this.socket.on("operationDone",function(M,Q){Y.handleRespone(M,Q)}),this.socket.on("download",function(M){Y.handler({type:"download",path:M})}),this.socket.on("confirm",function(M,Q){Y.handler({type:"confirm",path:M,datas:Q})})}return M.prototype.request=function(M,Q,b){var Y=++this.cookie;this.callbacks[Y]=b,this.cmds[Y]=M;var I=this.editor.sid;this.socket.emit(M,Y,Q,I?{sid:I}:null);var i=M;Q&&(ht.Default.isString(Q)?i=M+": "+Q:Q.path&&(i=M+": "+Q.path)),this.handler({type:"request",message:i,cmd:M,data:Q})},M.prototype.handleRespone=function(M,Q){var b=this.callbacks[M],Y=this.cmds[M];delete this.callbacks[M],delete this.cmds[M],b&&b(Q),this.handler({type:"response",message:Y,cmd:Y,data:Q})},M}(),n=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"scenes"))}return f(Q,M),Q.prototype.initTreeMenu=function(M,Q){this.addLocateTreeFileItem(Q),this.addNewFolderItem(Q,this.tree),this.addRenameItem(Q,this.tree),this.addDeleteItem(Q,this.tree)},Q.prototype.initListMenu=function(M,Q){this.addLocateListFileItem(Q),this.addNewFolderItem(Q,this.list),this.addCopyItem(Q),this.addPasteItem(Q),this.addRenameItem(Q,this.list),this.addDeleteItem(Q,this.list),this.addExportItem(Q)},Q}(hteditor.Explorer),B=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"models"))}return f(Q,M),Q.prototype.initTreeMenu=function(M,Q){this.addLocateTreeFileItem(Q),this.addNewFolderItem(Q,this.tree),this.addRenameItem(Q,this.tree),this.addDeleteItem(Q,this.tree)},Q.prototype.initListMenu=function(M,Q){this.addLocateListFileItem(Q),this.addNewFolderItem(Q,this.list),this.addCopyItem(Q),this.addPasteItem(Q),this.addRenameItem(Q,this.list),this.addDeleteItem(Q,this.list),this.addExportItem(Q)},Q}(hteditor.Explorer),V=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"symbols"))}return f(Q,M),Q.prototype.initTreeMenu=function(M,Q){this.addLocateTreeFileItem(Q),this.addNewFolderItem(Q,this.tree),this.addRenameItem(Q,this.tree),this.addDeleteItem(Q,this.tree)},Q.prototype.initListMenu=function(M,Q){this.addLocateListFileItem(Q),this.addNewFolderItem(Q,this.list),this.addCopyItem(Q),this.addPasteItem(Q),this.addRenameItem(Q,this.list),this.addDeleteItem(Q,this.list),this.addExportItem(Q)},Q}(hteditor.Explorer),k=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"assets"))}return f(Q,M),Q.prototype.initTreeMenu=function(M,Q){this.addLocateTreeFileItem(Q),this.addNewFolderItem(Q,this.tree),this.addRenameItem(Q,this.tree),this.addDeleteItem(Q,this.tree)},Q.prototype.initListMenu=function(M,Q){this.addLocateListFileItem(Q),this.addNewFolderItem(Q,this.list),this.addCopyItem(Q),this.addPasteItem(Q),this.addRenameItem(Q,this.list),this.addDeleteItem(Q,this.list)},Q}(hteditor.Explorer),K=hteditor.getString,U=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b,Y.editor.menus.push(Y);var I=[{label:K("editor.newsceneview"),action:function(){Y.editor.newScene()}},{label:K("editor.newmodel"),items:[{label:K("editor.obj"),action:function(){Y.editor.newOBJModel()}}]}];return Y.setItems(I),Y}return f(Q,M),Q}(ht.widget.ContextMenu),H=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this,b.gv));return Y.editor=b,Y}return f(Q,M),Q.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},Q.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},Q.prototype.getDataAt=function(M){return this.gv.getDataAt(M)},Q.prototype.getNodeAt=function(M){var Q=this.getDataAt(M);return Q instanceof ht.Node?Q:null},Q.prototype.setUp=function(){M.prototype.setUp.call(this),this.sm.cs()},Q.prototype.$0$=function(M){},Q.prototype.drawRect=function(M,Q,b,Y){Q=this.toRect(Q),Y&&(M.fillStyle=Y),b&&(M.strokeStyle=b),M.lineWidth=1,M.beginPath(),M.rect(Q.x,Q.y,Q.width,Q.height),M.stroke(),Y&&M.fill(),b&&M.stroke()},Q.prototype.drawPoint=function(M,Q,b,Y,I){Q=this.toPoint(Q),I&&(M.fillStyle=I),Y&&(M.strokeStyle=Y),M.lineWidth=1,M.beginPath(),M.arc(Q.x,Q.y,b,0,2*Math.PI,!0),I&&M.fill(),Y&&M.stroke()},Q.prototype.drawPoints=function(M,Q,b,Y,I){for(var i=0;i<Q.length;i++)this.drawPoint(M,Q[i],b,Y,I)},Q.prototype.drawLine=function(M,Q,b,Y){Q=this.toPoint(Q),b=this.toPoint(b),M.lineWidth=1,M.strokeStyle=Y,M.beginPath(),M.moveTo(Q.x,Q.y),M.lineTo(b.x,b.y),M.stroke()},Q.prototype.toRect=function(M){var Q=this.zoom;return{x:M.x*Q+this.tx,y:M.y*Q+this.ty,width:M.width*Q,height:M.height*Q}},Q.prototype.toPoint=function(M){return{x:M.x*this.zoom+this.tx,y:M.y*this.zoom+this.ty}},Q.prototype.addData=function(M){this.editor.dm.add(M),this.editor.sm.ss(M),this.editor.gv.setFocus()},Q.prototype.remove=function(M){this.dm.remove(M)},Q.prototype.lp=function(M){return this.gv.lp(M)},Z(Q,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),Q}(ht.graph.Interactor),l=function(M){function Q(b,Y,I){S(this,Q);var i=c(this,M.call(this,b));return i.createFunc=Y,i.points=[],i.segments=[],i.nextPoint=null,i.fill=I,i}return f(Q,M),Q.prototype.tearDown=function(){M.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},Q.prototype.$48$=function(M){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},Q.prototype.createShape=function(){if(this.points.length>1){var M=this.createFunc(this.points,this.segments);this.addData(M)}this.editor.resetInteractionState(),this.editor.pointsEditingMode=!0},Q.prototype.handle_mousedown=function(M){this.handle_touchstart(M)},Q.prototype.handle_touchstart=function(M){if(ht.Default.preventDefault(M),ht.Default.isLeftButton(M))if(this.gv.setFocus(M),ht.Default.isDoubleClick(M))this.createShape();else{var Q=this.lp(M);if(this.points.length){var b=this.points[this.points.length-1];if(Math.abs(b.x-Q.x)<.01&&Math.abs(b.y-Q.y)<.01)return}this.points.push(Q),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(M),this.editor.rulerView.validateCanvas()}},Q.prototype.handle_mousemove=function(M){this.nextPoint&&(this.nextPoint=this.lp(M),this.editor.rulerView.validateCanvas())},Q.prototype.$0$=function(M){M.beginPath();for(var Q=0,b=void 0,Y=void 0,I=void 0,i=0;i<this.segments.length;i++){var o=this.segments[i];1===o?(b=this.toPoint(this.points[Q++]),M.moveTo(b.x,b.y)):2===o?(b=this.toPoint(this.points[Q++]),M.lineTo(b.x,b.y)):3===o?(b=this.toPoint(this.points[Q++]),Y=this.toPoint(this.points[Q++]),M.quadraticCurveTo(b.x,b.y,Y.x,Y.y)):4===o?(b=this.toPoint(this.points[Q++]),Y=this.toPoint(this.points[Q++]),I=this.toPoint(this.points[Q++]),M.bezierCurveTo(b.x,po,y,Y.x,Y.y,I.x,I.y)):5===o&&M.closePath()}if(this.nextPoint){var T=this.toPoint(this.nextPoint);M.lineTo(T.x,T.y)}M.strokeStyle=hteditor.config.color_data_border,M.lineWidth=1,M.stroke(),this.fill&&(M.fillStyle=hteditor.config.color_transparent,M.fill()),this.drawPoints(M,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},Q}(H),O=function(M){function Q(b,Y){S(this,Q);var I=c(this,M.call(this,b));return I.createFunc=Y,I}return f(Q,M),Q.prototype.tearDown=function(){M.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},Q.prototype.handle_mousedown=function(M){this.handle_touchstart(M)},Q.prototype.handle_touchstart=function(M){ht.Default.preventDefault(M),ht.Default.isLeftButton(M)&&(this.gv.setFocus(M),this.p1=this.lp(M),this.startDragging(M))},Q.prototype.handleWindowMouseMove=function(M){this.handleWindowTouchMove(M)},Q.prototype.handleWindowMouseUp=function(M){this.handleWindowTouchEnd(M)},Q.prototype.handleWindowTouchMove=function(M){if(ht.Default.preventDefault(M),this.p1){this.p2=this.lp(M);var Q=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(Q);else{if(!Q.width||!Q.height)return;this.beginTransaction(),this.createNode(Q,!1)}}},Q.prototype.handleWindowTouchEnd=function(M){ht.Default.preventDefault(M),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.resetInteractionState()},Q.prototype.createNode=function(M,Q){this.node=this.createFunc(M,Q),this.node.s3(50,50,50),Q?this.node.setPosition(M.x+M.width/2,M.y+M.height/2):this.node.setRect(M),this.addData(this.node)},Q.prototype.$0$=function(M){this.node&&this.drawRect(M,this.node.getRect(),hteditor.config.color_data_border)},Q}(H),m=hteditor.getString,$=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));return Y.editor=b,Y.initMenu(),Y.$68$(),Y.enableToolTip(),Y}return f(Q,M),Q.prototype.initMenu=function(){var M=this.editor.mainMenu=new U(this.editor),Q=function(Q){M.isShowing()&&!M.getView().contains(Q.target)&&M.hide()};window.addEventListener("touchstart",Q,!1),window.addEventListener("mousedown",Q,!1)},Q.prototype.$68$=function(){var M=[];M.push(this.$67$()),M.push(this.createEditItem()),M.push(this.createCubeItem()),M.push(this.createCylinderItem()),M.push(this.createSphereItem()),M.push(this.createWallItem()),M.push(this.createDoorWindowItem()),M.push(this.createFloorItem()),M.push(this.createPipelineItem()),this.setItems(M)},Q.prototype.$67$=function(){var M=this,Q=hteditor.createItem("menu",m("editor.menu"),"editor.menu");return Q.action=function(Q,b,Y){M.editor.mainMenu.isShowing()||(M.editor.mainMenu.showOnView(M,4,20),Y.preventDefault(),Y.stopPropagation())},Q},Q.prototype.createEditItem=function(){return this.editor.createSceneItem("edit",m("editor.edit"),"editor.edit")},Q.prototype.createWallItem=function(){var M=p.config.color_data_background,Q=p.config.color_transparent;return this.editor.createSceneItem("wall",m("editor.wall"),"editor.wall",new l(this.editor,function(b,Y){var I=new ht.Shape;return I.setTall(280),I.setThickness(14),I.setElevation(I.getTall()/2),I.setPoints(b),I.setSegments(Y),I.s({"all.color":M,"shape.background":null,"shape.border.width":I.getThickness(),"shape.border.color":Q}),I}))},Q.prototype.createDoorWindowItem=function(){return this.editor.createSceneItem("doorWindow",m("editor.doorWindow"),"editor.doorWindow",new O(this.editor,function(){var M=new ht.DoorWindow;return M.s({"all.color":p.config.color_data_background}),M},!0))},Q.prototype.createFloorItem=function(){var M=p.config.color_data_background,Q=p.config.color_transparent;return this.editor.createSceneItem("floor",m("editor.floor"),"editor.floor",new l(this.editor,function(b,Y){var I=new ht.Shape;return I.setTall(10),I.setThickness(-1),I.setElevation(-I.getTall()/2),I.setPoints(b),I.setSegments(Y),I.s({"shape3d.color":M,"shape3d.top.color":M,"shape3d.bottom.color":M,"shape.background":Q}),I.setAnchor3d(.5,0,.5),I},!0))},Q.prototype.createPipelineItem=function(){var M=p.config.color_data_background,Q=p.config.color_transparent;return this.editor.createSceneItem("pipeline",m("editor.pipeline"),"editor.pipeline",new l(this.editor,function(b,Y){var I=new ht.Polyline;return I.setPoints(b),I.setSegments(Y),I.setThickness(10),I.s({shape3d:"cylinder","shape3d.color":M,"shape3d.top.color":M,"shape3d.bottom.color":M,"shape.background":null,"shape.border.width":I.getThickness(),"shape.border.color":Q}),I}))},Q.prototype.createCubeItem=function(){return this.editor.createSceneItem("cube",m("editor.cube"),"editor.cube",new O(this.editor,function(){var M=new ht.Node;return M.s({"all.color":p.config.color_data_background}),M.setAnchor3d(.5,0,.5),M},!0))},Q.prototype.createCylinderItem=function(){return this.editor.createSceneItem("cylinder",m("editor.cylinder"),"editor.cylinder",new O(this.editor,function(){var M=new ht.Node;return M.s({shape3d:"cylinder","shape3d.color":p.config.color_data_background}),M.setAnchor3d(.5,0,.5),M},!0))},Q.prototype.createSphereItem=function(){return this.editor.createSceneItem("sphere",m("editor.sphere"),"editor.sphere",new O(this.editor,function(){var M=new ht.Node;return M.s({shape3d:"sphere","shape3d.color":p.config.color_data_background}),M.setAnchor3d(.5,0,.5),M},!0))},Q}(ht.widget.Toolbar),w=hteditor.getString,g=hteditor.createItem,u=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));return Y.editor=b,Y.$68$(),Y.enableToolTip(),Y.setStickToRight(!0),Y.editor.gv.addPropertyChangeListener(Y.handlePropertyChange,Y),Y.$69$(),Y}return f(Q,M),Q.prototype.handlePropertyChange=function(M){"zoom"===M.property&&this.$69$()},Q.prototype.$69$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},Q.prototype.$68$=function(){var M=this,Q=void 0,b=[];Q=g("save",w("editor.save"),"editor.save"),Q.action=function(){M.editor.save()},b.push(Q),Q=g("reload",w("editor.reload"),"editor.reload"),Q.action=function(){M.editor.reload()},b.push(Q),b.push({separator:!0}),Q=g("rulers",w("editor.showrulers"),"editor.rulers",function(){return M.editor.isRulerEnabled()}),Q.action=function(){M.editor.toggleRulerEnabled()},b.push(Q),Q=g("grid",w("editor.showaxis"),"editor.axis",function(){return!M.editor.dm.a("sceneEditHelperDisabled")}),Q.action=function(){M.editor.dm.a("sceneEditHelperDisabled",!M.editor.dm.a("sceneEditHelperDisabled"))},b.push(Q),Q=g("grid",w("editor.showgrid"),"editor.grid",function(){return M.editor.dm.a("sceneGridEnabled")}),Q.action=function(){M.editor.dm.a("sceneGridEnabled",!M.editor.dm.a("sceneGridEnabled"))},b.push(Q),Q=g("preview",w("editor.preview"),"editor.preview"),Q.action=function(){M.editor.preview()},b.push(Q),b.push({separator:!0}),b.push(this.createZoomItem()),Q=g("zoomToFit",w("editor.zoomtofit"),"editor.zoomtofit"),Q.action=function(){M.editor.zoomToFit()},b.push(Q),b.push({separator:!0}),Q=g("toggleLeft",w("editor.toggleleft"),"editor.toggleleft"),Q.action=function(){M.editor.toggleLeft()},b.push(Q),Q=g("toggleRight",w("editor.toggleright"),"editor.toggleright"),Q.action=function(){M.editor.toggleRight()},b.push(Q),this.setItems(b)},Q.prototype.createZoomItem=function(){var M=this,Q=this.label=ht.Default.createDiv(!0);Q.style.font=this.getLabelFont(),Q.style.color=this.getLabelColor(),Q.style.cursor="ew-resize",Q.style.width="40px",Q.style.height=ht.Default.widgetRowHeight+"px",Q.style.lineHeight=ht.Default.widgetRowHeight+"px",Q.style.whiteSpace="nowrap",Q.style.textAlign="center";var b=function(Q){Q.preventDefault();var b=M.editor.gv;ht.Default.isDoubleClick(Q)&&b.zoomReset();var Y=b.getZoom(),I=ht.Default.getClientPoint(Q).x,i=function(M){M.preventDefault();var Q=ht.Default.getClientPoint(M).x-I;b.setZoom(Y*(1+.005*Q))};window.addEventListener("mousemove",i,!1),window.addEventListener("touchmove",i,!1);var o=function(M){M.preventDefault(),window.removeEventListener("mousemove",i,!1),window.removeEventListener("touchmove",i,!1),window.removeEventListener("mouseup",o,!1),window.removeEventListener("touchend",o,!1)};window.addEventListener("mouseup",o,!1),window.addEventListener("touchend",o,!1)};return Q.addEventListener("mousedown",b,!1),Q.addEventListener("touchstart",b,!1),{id:"zoom",unfocusable:!0,element:Q}},Q}(ht.widget.Toolbar),J=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this,b.dm));return Y.editor=b,Y.setEditable(!0),Y.topDiv=ht.Default.createDiv(),Y.getPostProcessing().setSerializable(!1),Y}return f(Q,M),Q.prototype.isInteractive=function(){return!1},Q.prototype.handleDelete=function(){this.removeSelection()},Q.prototype.getBrightness=function(M){return M.s("brightness")},Q.prototype.isDroppable=function(M,Q){return Q.view===this.editor.models.list||(Q.view===this.editor.symbols.list||Q.view===this.editor.assets.list)},Q.prototype.$58$=function(M){if(this.dragImage){var Q=hteditor.config.dragImageSize,b=ht.Default.getPagePoint(M);this.dragImage.style.left=b.x-Q/2+"px",this.dragImage.style.top=b.y-Q/2+"px"}},Q.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},Q.prototype.handleCrossDrag=function(M,Q,b){var Y=this,I=b.view,i=I.draggingData;if("enter"===Q){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&i&&("model"===i.fileType||"symbol"===i.fileType||"image"===i.fileType)&&ht.Default.getImage(i.getImage())!==ht.Default.getImage("editor.unknown")){var o=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(i.getImage(),o,o,"centerUniform",i,b.view,null,ht.Default.devicePixelRatio),this.$58$(M),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===Q||"cancel"===Q)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===Q)this.$58$(M);else if("drop"===Q&&(ht.Default.removeHTML(this.topDiv),i)){this.removeDragImage();var T=this.getHitPosition(M);I.isSelected(i)?I.sm().toSelection().each(function(Q){I.handleDropToEditView?I.handleDropToEditView(Y,Q,T,M):Y.$98$(Q,T)}):I.handleDropToEditView?I.handleDropToEditView(this,i,T,M):this.$98$(i,T)}},Q.prototype.$98$=function(M,Q){if(M){var b=M.getFileUUID(),Y=M.fileType;if("model"===Y||"symbol"===Y||o(b)){var I=new ht.Node;"model"===Y?I.s({shape3d:b}):("symbol"===Y||o(b))&&(I.s({shape3d:"billboard","shape3d.image":b,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),I.setImage(b)),I.setAnchor3d(.5,0,.5),I.p3(Q),I.s("wf.visible","selected"),this.dm().add(I),this.sm().ss(I)}}},Q.prototype.toImage=function(M){var Q=p.config.imageSize||400,b=this.getWidth(),Y=this.getHeight(),I=Math.max(b,Y),i=Q/I;return b=Math.floor(b*i),Y=Math.floor(Y*i),this.toCanvas(M,b,Y).toDataURL("image/png",1)},Q.prototype.invalidateAll=function(Q,b){if("imageLoaded"===b||"modelLoaded"===b){var Y=this.editor.inspector;Y&&("modelLoaded"===b?Y.filterPropertiesLater():Y.$34$(),Y.$85$&&Y.$85$())}M.prototype.invalidateAll.call(this,Q,b)},Q}(ht.graph3d.Graph3dView),W={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},A=function(){function M(Q,b){var Y=this;S(this,M),this.editor=Q,this.gv=this.graphView=b,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(M){"validate"===M.kind&&Y.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){Y.iv()}),this.dm.sm().addSelectionChangeListener(function(M){Y.iv()}),this.dm.addDataModelChangeListener(function(M){Y.iv()}),this.dm.addDataPropertyChangeListener(function(M){Y.handleDataPropertyChanged(M)}),this.dm.addPropertyChangeListener(function(M){Y.handleDataModelPropertyChanged(M)}),this.dm.addHierarchyChangeListener(function(M){Y.iv()}),this.dm.layout=function(M){Y._autoLayout||(Y._autoLayout=new ht.layout.AutoLayout(Y.graphView)),Y._autoLayout.layout(M,function(){Y.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(M){M.keep=!0}),b.getEditInteractor().alignmentGuideEnabled=!0,
hteditor.EditView.prototype.initRuler.call(this)}return M.prototype.handleDataPropertyChanged=function(M){W[M.property]&&this.iv()},M.prototype.handleDataModelPropertyChanged=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},M.prototype.onPropertyChanged=function(M){this.iv()},M.prototype.addData=function(M){this.dm.add(M),this.dm.sm().ss(M),this.graphView.setFocus()},M.prototype.validateCanvas=function(){var M=this.graphView._topCanvas;if(M){var Q=hteditor.initContext(M);Q.clearRect(0,0,M.clientWidth,M.clientHeight),this.graphView.getInteractors().each(function(M){M.$0$&&M.$0$(Q)}),Q.restore()}},M.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},M.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},M.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},M.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},M.prototype.updateAlignGuide=function(){hteditor.EditView.prototype.updateAlignGuide.apply(this,arguments)},M.prototype.getGridGuide=function(){return hteditor.EditView.prototype.getGridGuide.apply(this,arguments)},M.prototype.setRulerEnabled=function(M){this.dm.a("rulerEnabled",M)},M.prototype.isRulerEnabled=function(){return this.dm.a("rulerEnabled")},Z(M,[{key:"dm",get:function(){return this.graphView.dm()}}]),M}();hteditor.msClass(A,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var E=p.getString,r=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this,b.dm));return Y.editor=b,Y._topCanvas=ht.Default.createCanvas(),Y._topDiv=ht.Default.createDiv(),Y._view.insertBefore(Y._topCanvas,Y._scrollBarDiv),Y._view.insertBefore(Y._topDiv,Y._scrollBarDiv),Y.initMenu(),Y.mi(function(M){"prepareMove"!==M.kind&&"prepareEdit"!==M.kind||!M.event.altKey||(Y.editor.copy(),Y.editor.paste(),Y.validate())}),Y.editable=!0,Y}return f(Q,M),Q.prototype.isInteractive=function(){return!1},Q.prototype.initMenu=function(){var M=this,Q=[];this.menu=new ht.widget.ContextMenu(Q),Q.push({id:"copy",label:E("editor.copy"),action:function(){M.editor.copy()},visible:function(){return!!M.editor.ld}}),Q.push({id:"paste",label:E("editor.paste"),action:function(){M.editor.paste()},visible:function(){return M.editable&&M.editor.hasCopyInfo()}});var b=function(){return M.sm().size()>0},Y=function(){for(var Q=0;Q<M.sm().size();Q++){var b=M.sm().getSelection().get(Q);if(b instanceof ht.Block&&!(b instanceof ht.RefGraph))return!0}return!1};Q.push({separator:!0,visible:function(){return M.editable&&(b()||Y())}}),Q.push({id:"block",label:E("editor.block"),action:function(){M.editor.block()},visible:function(){return M.editable&&b()}}),Q.push({id:"unblock",label:E("editor.unblock"),action:function(){M.editor.unblock()},visible:function(){return M.editable&&Y()}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},Q.prototype.getUnionNodeRect=function(M){var Q=this,b=void 0;return M=M._as||M,M.forEach(function(M){M instanceof ht.Node&&(b=ht.Default.unionRect(b,Q.getNodeRect(M)))}),b},Q.prototype.getImage=function(M){var Q=M.s("shape3d");if(Q){var b=ht.Default.getShape3dModel(Q);if(b&&b.json&&b.json.image)return b.json.image;if("sphere"===Q||"cylinder"===Q)return"editor.sphere.image"}var Y=M.getImage();return Y&&"node_image"!==Y?Y:M.s("shape3d.image")?M.s("shape3d.image"):"editor.cube.image"},Q.prototype.getSelectWidth=function(M){return!this.isEditable(M)||M instanceof ht.Edge?M.s("select.width"):0},Q.prototype.isDroppable=function(M,Q){return Q.view===this.editor.models.list||(Q.view===this.editor.symbols.list||Q.view===this.editor.assets.list)},Q.prototype.$58$=function(M){if(this.dragImage){var Q=hteditor.config.dragImageSize,b=ht.Default.getPagePoint(M);this.dragImage.style.left=b.x-Q/2+"px",this.dragImage.style.top=b.y-Q/2+"px"}},Q.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},Q.prototype.handleCrossDrag=function(M,Q,b){var Y=this,I=b.view,i=I.draggingData;if("enter"===Q){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&i&&("model"===i.fileType||"symbol"===i.fileType||"image"===i.fileType)&&ht.Default.getImage(i.getImage())!==ht.Default.getImage("editor.unknown")){var o=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(i.getImage(),o,o,"centerUniform",i,b.view,null,ht.Default.devicePixelRatio),this.$58$(M),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===Q||"cancel"===Q?(this._topDiv.style.border="",this.removeDragImage()):"over"===Q?this.$58$(M):"drop"===Q&&(this._topDiv.style.border="",i&&(this.removeDragImage(),this.sm().cs(),I.handleDropToEditView?I.handleDropToEditView(this,i,this.lp(M),M):I.isSelected(i)?I.sm().toSelection().each(function(Q){Y.$98$(Q,M)}):this.$98$(i,M)))},Q.prototype.$98$=function(M,Q){var b=M.getFileUUID(),Y=this.lp(Q);if("model"===M.fileType){var I=new ht.Node;I.s({shape3d:b}),I.setAnchor3d(.5,0,.5),I.setPosition(Y),this.dm().add(I),this.sm().ss(I)}else if("symbol"===M.fileType||"image"===M.fileType){var i=new ht.Node;i.s({shape3d:"billboard","shape3d.image":b,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),i.setAnchor3d(.5,0,.5),i.p(Y),i.setImage(b),this.dm().add(i),this.sm().ss(i)}},Q}(ht.graph.GraphView),a=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b))}return f(Q,M),Q.prototype.commit=function(){this.editor.reset(!0),this.editor.dm.disableHistoryManager(),this.editor.deserialize(this.content),this.editing=!1,this.editor.dm.enableHistoryManager(),this.editor.dm.clearHistoryManager()},Q.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},Q.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},Q.prototype.$5$=function(){},Q}(hteditor.DataView),j=hteditor.getString,q=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b,Y.buttons={};var I=[];I.push(Y.createItem("cluster",j("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),I.push(Y.createItem("distributeHorizontal",j("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),I.push(Y.createItem("distributeVertical",j("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),I.push(Y.createItem("alignLeft",j("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),I.push(Y.createItem("alignHorizontal",j("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),I.push(Y.createItem("alignRight",j("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),I.push(Y.createItem("alignTop",j("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),I.push(Y.createItem("alignVertical",j("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),I.push(Y.createItem("alignBottom",j("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var i=.1,o=[i,i,i,i,i,i,i,i,i];return Y.addRow(I,o),Y.updateItems(),Y.editor.sm.ms(function(){return Y.updateItems()}),Y}return f(Q,M),Q.prototype.createItem=function(M,Q,b){var Y=this;b.forEach(function(M){M.borderCap="round"}),b[0].borderColor=b[0].borderColor||hteditor.config.color_dark,b[1].borderColor=b[1].borderColor||hteditor.config.color_select;var I={width:16,height:16,fitSize:!0,comps:b};return this.buttons[M]=hteditor.createButton(null,Q,I,function(){Y[M]()})},Q.prototype.updateItems=function(){var M=[];this.editor.sm.each(function(Q){Q instanceof ht.Node&&M.push(Q)}),M.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):M.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},Q.prototype.getUnionRect=function(M){return this.editor.gv?this.editor.gv.getUnionNodeRect(M):null},Q.prototype.isSelected=function(M){return this.editor.sm.contains(M)},Q.prototype.hasSelectedGroupParent=function(M){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},Q.prototype.hasSelectedHost=function(M){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},Q.prototype.cluster=function(){var M=this.selection;if(M.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var Q=void 0,b=void 0;M.forEach(function(M){void 0===Q?Q=b=M.getElevation():(Q>M.getElevation()&&(Q=M.getElevation()),b<M.getElevation()&&(b=M.getElevation()))}),M.sort(function(M,Q){return M.getElevation()-Q.getElevation()});for(var Y=(b-Q)/(M.length-1),I=1;I<M.length-1;I++)M[I].setElevation(Q+I*Y);this.editor.endTransaction()}},Q.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},Q.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},Q.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},Q.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},Q.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},Q.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},Q.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},Q.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},Z(Q,[{key:"selection",get:function(){var M=this,Q=[];return this.editor.sm.each(function(b){b instanceof ht.Node&&(M.hasSelectedGroupParent(b.getParent())||M.hasSelectedHost(b)||Q.push(b))}),Q}}]),Q}(ht.widget.FormPane),e=function(M){function Q(b,Y,I){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];S(this,Q);var o=c(this,M.call(this,b,Y,I,i));return o.setHPadding(8),o.setVPadding(4),o.addUpdateHandler(function(){o.$85$()}),o._cacheImgObjects=[],o}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.addCustomProperties()},Q.prototype.addOneRow=function(M,Q,b){for(var Y=[this.indent,.1],I=2,i=M.length;I<i;I++)Y.push(20);var o=this.addRow(M,Y,Q?this.getRowHeight()*Q:null,b);return o.index=this.getRows().length-1,o},Q.prototype.$85$=function(){var M=this;this._updateDataBindingsLater||(this._updateDataBindingsLater=!0,requestAnimationFrame(function(){M.initDataBindings()}))},Q.prototype.initDataBindings=function(){var M=this;this._updateDataBindingsLater=!1;var Q=this.data;if(Q){for(var b=[Q.s("all.image"),Q.s("top.image"),Q.s("bottom.image"),Q.s("left.image"),Q.s("right.image"),Q.s("front.image"),Q.s("back.image"),Q.s("shape3d.image"),Q.s("shape3d.top.image"),Q.s("shape3d.bottom.image"),Q.s("shape3d.from.image"),Q.s("shape3d.to.image")],Y=!1,I=[],i=0,o=b.length;i<o;i++){var C=b[i];if(C){if(!(C=ht.Default.getImage(C))){Y=!0;break}I.push(C)}}if(Y){var R=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var Q=arguments.length,b=Array(Q),Y=0;Y<Q;Y++)b[Y]=arguments[Y];R.apply(ht.Default,b),ht.Default.handleImageLoaded=R,M.initDataBindings()})}if(0===I.length)return void(this.$44$&&this.$44$.length>0&&(this.clearDataBinding(),this.filterProperties()));var t=this._cacheImgObjects,L=t.length!==I.length;if(!L)for(var G=0,s=I.length;G<s;G++)if(t.indexOf(I[G])<0){L=!0;break}if(L){this.clearDataBinding(),this._cacheImgObjects=I;for(var F=[],P={},_={},S={},Z=0,f=I.length;Z<f;Z++){var c=I[Z];if(c.comps){c.comps.forEach(function(M){if(T(M.type)){var Q=ht.Default.getCompType(M.type);if(Q)for(var b in Q.properties)P[b]=Q.properties[b].defaultValue}X(M,_,S)});for(var z in _)void 0===S[z]&&(S[z]=P[_[z]])}c.dataBindings&&F.push.apply(F,c.dataBindings)}if(F.length>0){var n=this.updateHandlers.length;this.$44$.push(this.addTitle("TitleDataBinding"));var B={};F.forEach(function(Q){var b=Q.attr;B[b]||(B[b]=1,p.HTNodeInspector.prototype.$87$.call(M,Q,void 0,S))}),this.dataBindingHandlers=this.updateHandlers.slice(n)}this.$46$=this._rows,this.filterProperties()}}},Q.prototype.clearDataBinding=function(){var M=this;this._rows=this.$46$;var Q=this.$44$;Q&&Q.length>0&&this.removeRows(Q),this.$44$=[];var b=this.dataBindingHandlers;b&&b.length>0&&b.forEach(function(Q){M.removeUpdateHandler(Q)}),this.dataBindingHandlers=[],this._cacheImgObjects=[],this.$46$=this._rows},Q.prototype.$87$=function(M,Q){var b=[],Y=M.attr,I=hteditor.config.valueTypes[M.valueType];if(!I)return this.editor.fireEvent("error",{message:"Wrong value type:"+M.valueType,dataBind:M}),!1;var i=hteditor.getString(M.name)||Y,o=function(M){var b=M.a(Y);return void 0===b&&(b=Q[Y]),b},T=function(M,Q){return M.a(Y,Q)};return"int"===I.type||"number"===I.type?I.angle?this.addLabelRotation(b,i,o,T,I.min,I.max,I.step):this.addLabelRange(b,i,o,T,I.min,I.max,I.step,I.type):"color"===I.type?this.addLabelColor(b,i,o,T):"boolean"===I.type?this.addLabelCheckBox(b,i,o,T):"enum"===I.type?this.addLabelComboBox(b,i,o,T,I.values,I.labels,I.icons):"multiline"===I.type?this.addLabelMultiline(b,i,o,T):"font"===I.type?this.addLabelFont(b,i,o,T):"image"===I.type?this.addLabelImage(b,i,o,T):"url"===I.type?this.addLabelURL(b,i,o,T):"colorArray"===I.type?this.addLabelArray(b,i,o,T,"color"):"numberArray"===I.type?this.addLabelArray(b,i,o,T,"number"):"stringArray"===I.type?this.addLabelArray(b,i,o,T,"string"):"objectArray"===I.type?this.addLabelArray(b,i,o,T,"object"):"function"===I.type?this.addLabelFunction(b,i,o,T,Y):"object"===I.type?this.addLabelObject(b,i,o,T,Y):this.addLabelInput(b,i,o,T),b},Q.prototype.addLabelData=function(M,Q,b,Y){var I=this,i=this.addLabelInput(M,Q,function(M){var Q=b(M);return Q?Q.toLabel()||Q.getClassName():""}),o=i.getElement();i.isDroppable=function(M,Q){return Q.view.draggingData&&I.dataModel===Q.view.draggingData.getDataModel()},i.handleCrossDrag=function(M,Q,b){"enter"===Q?o.style.border="solid "+p.config.color_select_dark+" 2px":"exit"===Q||"cancel"===Q?o.style.border="":"over"===Q||"drop"===Q&&(o.style.border="",I.setValue(Y,b.view.draggingData),i.setFocus())},o.onkeydown=function(M){ht.Default.isDelete(M)&&I.setValue(Y,null)};var T=new ht.widget.Image;T.drawImage=function(M,Q,b,Y,i,o){var C=T.data,R=I.editor.list;C&&R&&R.dm().contains(C)&&(Q=R.getIcon(C))&&drawStretchImage(M,ht.Default.getImage(Q),"centerUniform",b,Y,i,o,C,R)},this.updateHandlers.push(function(){if(!M.hidden){var Q=T.data;T.data=I.getValue(b),T.fp("data",Q,T.data)}}),M.push(T)},Q.prototype.addImage=function(M,Q,b,Y,I){var i=this,o=new ht.widget.Image;o.vectorDataBindingDisabled=!0;var T=Y||function(M){var Q=ht.Default.getImage(M);return Q&&Q.snapshotURL?Q.snapshotURL:M};this.updateHandlers.push(function(){if(!M.hidden){var b=i.getValue(Q);o.rawIcon=b,o.setIcon(T(b))}});var C=o.getView();C.style.cursor="pointer";var R=function(M){M.preventDefault(),I&&!I(o)||(ht.Default.isDoubleClick(M)?i.editor.open(o.rawIcon):i.editor.selectFileNode(o.rawIcon))};return C.addEventListener("mousedown",R,!1),C.addEventListener("touchstart",R,!1),M.push(o),o},Z(Q,[{key:"type",set:function(M){this._type=M},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}}]),Q}(hteditor.Inspector),D=hteditor.getString,x=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"scene","scene",!0))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.initSceneProperties(),this.addBloomProperties(),this.addDofProperties(),this.addHighlightProperties(),this.$77$(),this.editor.scene.shadowMap&&this.initShadowProperties()},Q.prototype.initSceneProperties=function(){var M=this,Q=void 0;this.addTitle("TitleScenes"),Q=[],this.addLabelCheckBox(Q,D("editor.debugTip"),function(){return M.editor.scene.isDebugTipShowing()},function(Q,b){var Y=M.editor.scene;b?Y.showDebugTip():Y.hideDebugTip()}),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelInput(Q,D("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(Q,[this.indent,.1]),Q=[],Q.push(D("editor.camera")),this.addButton(Q,null,D("editor.reset"),"editor.resetsize.state",function(){M.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(Q,"X",function(Q){return parseFloat(M.editor.scene.getEye()[0])},function(Q,b){var Y=M.editor.scene.getEye();M.editor.scene.setEye(b,Y[1],Y[2])},"int",1),this.addLabelInput(Q,"Y",function(Q){return parseFloat(M.editor.scene.getEye()[1])},function(Q,b){var Y=M.editor.scene.getEye();M.editor.scene.setEye(Y[0],b,Y[2])},"int",1),this.addLabelInput(Q,"Z",function(Q){return parseFloat(M.editor.scene.getEye()[2])},function(Q,b){var Y=M.editor.scene.getEye();M.editor.scene.setEye(Y[0],Y[1],b)},"int",1),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]),Q=[],Q.push(D("editor.center")),this.addButton(Q,null,D("editor.reset"),"editor.resetsize.state",function(){M.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(Q,"X",function(Q){return parseFloat(M.editor.scene.getCenter()[0])},function(Q,b){var Y=M.editor.scene.getCenter();M.editor.scene.setCenter(b,Y[1],Y[2])},"int",1),this.addLabelInput(Q,"Y",function(Q){return parseFloat(M.editor.scene.getCenter()[1])},function(Q,b){var Y=M.editor.scene.getCenter();M.editor.scene.setCenter(Y[0],b,Y[2])},"int",1),this.addLabelInput(Q,"Z",function(Q){return parseFloat(M.editor.scene.getCenter()[2])},function(Q,b){var Y=M.editor.scene.getCenter();M.editor.scene.setCenter(Y[0],Y[1],b)},"int",1),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]),Q=[],this.addLabelRange(Q,D("editor.near"),function(M){return M.a("sceneNear")},function(M,Q){return M.a("sceneNear",Q)},1,void 0,1,"int"),this.addLabelRange(Q,D("editor.far"),function(M){return M.a("sceneFar")},function(M,Q){return M.a("sceneFar",Q)},0,void 0,100,"int"),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelColor(Q,D("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelImage(Q,D("editor.envmapimage"),function(Q){var b=Q.getEnvmap(),Y=M.editor.getFileNode(b);return Y?Y.url:b},function(M,Q){return M.setEnvmap(Q)}),this.addRow(Q,[this.indent,.1,20]);this.editor.scene;Q=[];var b=[["Obejct","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"]];this.addLabelFunction(Q,D("editor.onpredeserialize"),function(M){return M.a("onPreDeserialize")},function(M,Q){M.a("onPreDeserialize",Q)},"onPreDeserialize",b),this.addOneRow(Q),Q=[],b=[["Obejct","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"],["ht.List","datas","editor.comment.datas"]],this.addLabelFunction(Q,D("editor.onpostdeserialize"),function(M){return M.a("onPostDeserialize")},function(M,Q){M.a("onPostDeserialize",Q)},"onPostDeserialize",b),this.addOneRow(Q),Q=[],this.addLabelComboBox(Q,D("editor.orthographic"),function(M){return M.a("sceneOrthographic")},function(M,Q){return M.a("sceneOrthographic",Q)},[!1,"top","right","front"],[D("editor.none"),D("editor.viewtype.top"),D("editor.viewtype.right"),D("editor.viewtype.front")]),this.addOneRow(Q)},Q.prototype.addBloomProperties=function(){this.addTitle("TitleBloom");var M=[];this.addLabelCheckBox(M,D("editor.bloom"),function(M){return M.a("sceneBloom")},function(M,Q){return M.a("sceneBloom",Q)}),this.addLabelRange(M,D("editor.strength"),function(M){return M.a("sceneBloomStrength")},function(M,Q){return M.a("sceneBloomStrength",Q)},0,void 0,.01,"number"),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelRange(M,D("editor.radius"),function(M){return M.a("sceneBloomRadius")},function(M,Q){return M.a("sceneBloomRadius",Q)},0,void 0,.01,"number"),this.addLabelRange(M,D("editor.threshold"),function(M){return M.a("sceneBloomThreshold")},function(M,Q){return M.a("sceneBloomThreshold",Q)},0,1,.01,"number"),this.addRow(M,[this.indent,.1,this.indent2,.1])},Q.prototype.addDofProperties=function(){var M=this;this.addTitle("TitleDOF");var Q=[];this.addLabelCheckBox(Q,D("editor.dof"),function(M){return M.a("sceneDof")},function(M,Q){return M.a("sceneDof",Q)}),this.addLabelRange(Q,D("editor.aperture"),function(M){return M.a("sceneDofAperture")},function(M,Q){return M.a("sceneDofAperture",Q)},0,1,.001,"number"),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelImage(Q,D("editor.image"),function(Q){var b=Q.a("sceneDofImage"),Y=M.editor.getFileNode(b);return Y?Y.url:b},function(M,Q){return M.a("sceneDofImage",Q)}),this.addRow(Q,[this.indent,.1,20])},Q.prototype.addHighlightProperties=function(){this.addTitle("TitleHighlight");var M=[];this.addLabelRange(M,D("editor.width"),function(M){return M.a("sceneHighlightWidth")},function(M,Q){return M.a("sceneHighlightWidth",Q)},0,void 0,.1,"number"),this.addLabelColor(M,D("editor.color"),function(M){return M.a("sceneHighlightColor")},function(M,Q){M.a("sceneHighlightColor",Q)}),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelComboBox(M,D("editor.mode"),function(M){return M.a("sceneHighlightMode")},function(M,Q){M.a("sceneHighlightMode",Q)},["disabled","selected","hover","style"],[D("editor.highlightmode.disabled"),D("editor.highlightmode.selected"),D("editor.highlightmode.hover"),D("editor.highlightmode.style")]),this.addRow(M,[this.indent,.1])},Q.prototype.$77$=function(){this.addTitle("TitleGridsGuides");var M=[];this.addLabelColor(M,D("editor.gridcolor"),function(M){return M.a("sceneGridColor")},function(M,Q){M.a("sceneGridColor",Q)}),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.gridsize"),function(M){return M.a("sceneGridBlockCount")},function(M,Q){M.a("sceneGridBlockCount",Q)},0,void 0,1,"int"),this.addLabelRange(M,D("editor.gridgap"),function(M){return M.a("sceneGridBlockSize")},function(M,Q){M.a("sceneGridBlockSize",Q)},1,void 0,1,"int"),this.addRow(M,[this.indent,.1,this.indent2,.1])},Q.prototype.initShadowProperties=function(){this.editor.scene,this.editor.scene.shadowMap;this.addTitle("TitleShadow");var M=[];this.addLabelCheckBox(M,D("editor.shadow.enable"),function(M){return M.a("sceneShadowEnabled")},function(M,Q){return M.a("sceneShadowEnabled",Q)}),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.shadow.degreeX"),function(M){return M.a("sceneShadowDegreeX")},function(M,Q){return M.a("sceneShadowDegreeX",Q)},0,360,.01,"number"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.shadow.degreeZ"),function(M){return M.a("sceneShadowDegreeZ")},function(M,Q){return M.a("sceneShadowDegreeZ",Q)},-90,90,.01,"number"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.shadow.intensity"),function(M){return M.a("sceneShadowIntensity")},function(M,Q){return M.a("sceneShadowIntensity",Q)},0,1,.01,"number"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelComboBox(M,D("editor.shadow.quality"),function(M){return M.a("sceneShadowQuality")},function(M,Q){return M.a("sceneShadowQuality",Q)},["low","medium","high","ultra"],[D("editor.shadow.quality.low"),D("editor.shadow.quality.medium"),D("editor.shadow.quality.high"),D("editor.shadow.quality.ultra")]),this.addRow(M,[this.indent,.1]),M=[],this.addLabelComboBox(M,D("editor.shadow.type"),function(M){return M.a("sceneShadowType")},function(M,Q){return M.a("sceneShadowType",Q)},["none","hard","soft"],[D("editor.shadow.type.none"),D("editor.shadow.type.hard"),D("editor.shadow.type.soft")]),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.shadow.radius"),function(M){return M.a("sceneShadowRadius")},function(M,Q){return M.a("sceneShadowRadius",Q)},0,100,.1,"number"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,D("editor.shadow.bias"),function(M){return M.a("sceneShadowBias")},function(M,Q){return M.a("sceneShadowBias",Q)},-.01,.01,1e-4,"number"),this.addRow(M,[this.indent,.1])},Q}(e),N=hteditor.getString,h={undefined:"editor.cube",null:"editor.cube",sphere:"editor.sphere",cylinder:"editor.cylinder",cone:"editor.scene.cone",torus:"editor.scene.torus",triangle:"editor.scene.triangle",rightTriangle:"editor.scene.rightTriangle",parallelogram:"editor.scene.parallelogram",trapezoid:"editor.scene.trapezoid",rect:"editor.scene.rect",roundRect:"editor.scene.roundRect",star:"editor.scene.star",box:"editor.scene.box",billboard:"editor.scene.billboard",plane:"editor.scene.plane"},v=function(M){function Q(b,Y){return S(this,Q),c(this,M.call(this,b,Y,"data3d",!1))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.$11$(),this.addWireframeProperties(),this.addTransformProperties(),this.editor.scene.shadowMap&&this.$19$()},Q.prototype.$11$=function(){var M=this;this.addTitle("TitleBasic"),this.addEventProperties();var Q=[];this.addLabelInput(Q,N("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(Q,N("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelInput(Q,N("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(Q,[this.indent,.1]);var b=[void 0,"billboard","plane","box","sphere","cone","torus","cylinder","star","rect","roundRect","triangle","rightTriangle","parallelogram","trapezoid"],Y=[],I=[];b.forEach(function(M){Y.push(N("editor."+(M?M.toLowerCase():"cube"))),I.push({width:16,height:16,comps:[{type:"image",stretch:"centerUniform",color:p.config.color_dark,name:h[M],rect:[0,0,16,16]}]})}),Q=[],this.addLabelComboBoxURL(Q,N("editor.type"),function(Q){var b=Q.s("shape3d");if(T(b)){var Y=M.editor.getFileNode(b);return Y?Y.url:b}return b},function(Q,b){Q.s("shape3d",b),M.editor.updateInspector()},b,Y,I,function(M,Q){return!!Q.view.draggingData&&"model"===Q.view.draggingData.fileType}),this.addImage(Q,function(M){return M.s("shape3d")},void 0,function(M){return T(M)?M.substr(0,M.length-5)+".png":null},function(M){return hteditor.isJSON(M.rawIcon)}),this.addOneRow(Q),Q=[],this.addLabelCheckBox(Q,N("editor.selectable"),function(M){return M.s("3d.selectable")},function(M,Q){M.s("2d.selectable",Q),M.s("3d.selectable",Q)}),this.addLabelCheckBox(Q,N("editor.movable"),function(M){return M.s("3d.movable")},function(M,Q){M.s("2d.movable",Q),M.s("3d.movable",Q)}),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelCheckBox(Q,N("editor.editable"),function(M){return M.s("3d.editable")},function(M,Q){M.s("2d.editable",Q),M.s("3d.editable",Q)}),this.addLabelCheckBox(Q,N("editor.visible"),function(M){return M.s("3d.visible")},function(M,Q){M.s("2d.visible",Q),M.s("3d.visible",Q)}),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelCheckBox(Q,N("editor.mask"),function(M){return M.s("transparent.mask")},function(M,Q){return M.s("transparent.mask",Q)}),this.addLabelCheckBox(Q,N("editor.cache"),function(M){return M.s("texture.cache")},function(Q,b){Q.s("texture.cache",b),null!=Q.s("shape3d.image.cache")&&Q.s("shape3d.image.cache",void 0),M.editor.scene.invalidateShape3dCachedImage(Q)}),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[];var i=function(M){var Q=M.s("fixSizeOnScreen");return null==Q&&(Q=M.s("shape3d.fixSizeOnScreen")),!!Q};this.addLabelCheckBox(Q,N("editor.fitsize"),i,function(M,Q){M.s("fixSizeOnScreen",!!Q&&[-1,-1]),null!=M.s("shape3d.fixSizeOnScreen")&&M.s("shape3d.fixSizeOnScreen",void 0),Q&&M.s("autorotate",!0)});var o=this.addLabelCheckBox(Q,N("editor.dynamic"),function(M){var Q=M.s("vector.dynamic");return null==Q&&(Q=M.s("shape3d.vector.dynamic")),!!Q},function(M,Q){M.s("vector.dynamic",Q),null!=M.s("shape3d.vector.dynamic")&&M.s("shape3d.vector.dynamic",void 0)});this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelCheckBox(Q,N("editor.alwaysontop"),function(M){if(M.getRenderLayer)return"top"===M.getRenderLayer();var Q=M.s("alwaysOnTop");return null==Q&&(Q=M.s("shape3d.alwaysOnTop")),Q},function(M,Q){M.setRenderLayer?(M.setRenderLayer(Q?"top":null),M.s("alwaysOnTop",void 0)):M.s("alwaysOnTop",Q),M.s("shape3d.alwaysOnTop",void 0)});var C=function(M){var Q=M.s("autorotate");return null==Q&&(Q=M.s("shape3d.autorotate")),Q},R=this.addLabelComboBox(Q,N("editor.autorotate"),C,function(M,Q){M.s("autorotate",Q),null!=M.s("shape3d.autorotate")&&M.s("shape3d.autorotate",void 0)},[!1,!0,"x","y","z"]);if(this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelRange(Q,N("editor.texturescale"),function(M){var Q=void 0;return 1!==M.s("texture.scale")?Q=M.s("texture.scale"):1!==M.s("shape3d.texture.scale")&&(Q=M.s("shape3d.texture.scale")),Q||1},function(M,Q){M.s("texture.scale",Q),M.s("shape3d.texture.scale",void 0)},0,10,.1,"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelRange(Q,N("editor.envmap"),function(M){return M.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelRange(Q,N("editor.brightness"),function(M){return M.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelObject(Q,N("editor.polygonoffset"),function(M){return M.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelComboBox(Q,N("editor.clipdirection"),function(M){return M.s("3d.clip.direction")},function(M,Q){M.s("3d.clip.direction",Q)},[null,"left","right","top","bottom","front","back"],["",N("editor.clipdirection.left"),N("editor.clipdirection.right"),N("editor.clipdirection.top"),N("editor.clipdirection.bottom"),N("editor.clipdirection.front"),N("editor.clipdirection.back")]),this.addOneRow(Q),Q=[],this.addLabelRange(Q,N("editor.clippercentage"),function(M){
return M.s("3d.clip.percentage")},function(M,Q){M.s("3d.clip.percentage",Q)},0,1,.01,"number"),this.addOneRow(Q),p.config.batchEditable){Q=[];this.addLabelComboBox(Q,N("editor.batch"),function(M){return M.s("batch")},function(M,Q){return M.s("batch",Q)},[],[]).getValues=function(){return M.editor.batchView.keys},this.addOneRow(Q)}this.updateHandlers.push(function(){if(M.data){var Q=i(M.data);R.setDisabled(Q),o.setDisabled(Q)}})},Q.prototype.addTransformProperties=function(){this.addTitle("TitleTransform");var M=p.config.numberPrecision,Q=[];this.addLabelComboBox(Q,N("editor.rotationMode"),function(M){return M.getRotationMode()},function(M,Q){return M.setRotationMode(Q)},["xyz","xzy","yxz","yzx","zxy","zyx"]),this.addRow(Q,[this.indent,.1]);var b=M.rotation||0;I=0===b?"int":"number",i=1/Math.pow(10,b),Q=[],Q.push(N("editor.rotation")),this.addButton(Q,null,N("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Node&&M.r3(0,0,0)}),this.addLabelInput(Q,"X",function(M){return Number((180/Math.PI*M.getRotationX()).toFixed(b))},function(M,Q){M instanceof ht.Node&&M.setRotationX(Q*Math.PI/180)},I,i),this.addLabelInput(Q,"Y",function(M){return Number((180/Math.PI*M.getRotationY()).toFixed(b))},function(M,Q){M instanceof ht.Node&&M.setRotationY(Q*Math.PI/180)},I,i),this.addLabelInput(Q,"Z",function(M){return Number((180/Math.PI*M.getRotationZ()).toFixed(b))},function(M,Q){M instanceof ht.Node&&M.setRotationZ(Q*Math.PI/180)},I,i),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var Y=M.position||0,I=0===Y?"int":"number",i=1/Math.pow(10,Y);Q=[],Q.push(N("editor.position")),this.addButton(Q,null,N("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Node&&M.p3(0,0,0)}),this.addLabelInput(Q,"X",function(M){return Number(M.getX().toFixed(Y))},function(M,Q){return M.setX(parseFloat(Q))},I,i),this.addLabelInput(Q,"Y",function(M){return Number(M.getElevation().toFixed(Y))},function(M,Q){return M.setElevation(parseFloat(Q))},I,i),this.addLabelInput(Q,"Z",function(M){return Number(M.getY().toFixed(Y))},function(M,Q){return M.setY(parseFloat(Q))},I,i),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var o=M.size||0;I=0===o?"int":"number",i=1/Math.pow(10,o),Q=[],Q.push(N("editor.size")),this.addButton(Q,null,N("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Node&&M.s3(-1,-1,-1)}),this.addLabelInput(Q,"X",function(M){return Number(M.getWidth().toFixed(o))},function(M,Q){return M.setWidth(parseFloat(Q))},I,i),this.addLabelInput(Q,"Y",function(M){return Number(M.getTall().toFixed(o))},function(M,Q){return M.setTall(parseFloat(Q))},I,i),this.addLabelInput(Q,"Z",function(M){return Number(M.getHeight().toFixed(o))},function(M,Q){return M.setHeight(parseFloat(Q))},I,i),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var T=M.anchor||0;I=0===T?"int":"number",i=1/Math.pow(10,T),Q=[],Q.push(N("editor.anchor")),this.addButton(Q,null,N("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Node&&M.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(Q,"X",function(M){return Number(M.getAnchorX().toFixed(T))},function(M,Q){M instanceof ht.Node&&M.setAnchor3d(parseFloat(Q),M.getAnchorElevation(),M.getAnchorY(),!0)},I,i),this.addLabelInput(Q,"Y",function(M){return Number(M.getAnchorElevation().toFixed(T))},function(M,Q){M instanceof ht.Node&&M.setAnchor3d(M.getAnchorX(),parseFloat(Q),M.getAnchorY(),!0)},I,i),this.addLabelInput(Q,"Z",function(M){return Number(M.getAnchorY().toFixed(T))},function(M,Q){M instanceof ht.Node&&M.setAnchor3d(M.getAnchorX(),M.getAnchorElevation(),parseFloat(Q),!0)},I,i),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var C=M.scale||0;I=0===C?"int":"number",i=1/Math.pow(10,C),Q=[],Q.push(N("editor.scale")),this.addButton(Q,null,N("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Node&&M.setScale3d(1,1,1)}),this.addLabelInput(Q,"X",function(M){return Number(M.getScaleX().toFixed(C))},function(M,Q){M instanceof ht.Node&&M.setScaleX(parseFloat(Q))},I,i),this.addLabelInput(Q,"Y",function(M){return Number(M.getScaleTall().toFixed(C))},function(M,Q){M instanceof ht.Node&&M.setScaleTall(parseFloat(Q))},I,i),this.addLabelInput(Q,"Z",function(M){return Number(M.getScaleY().toFixed(C))},function(M,Q){M instanceof ht.Node&&M.setScaleY(parseFloat(Q))},I,i),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1])},Q.prototype.addWireframeProperties=function(){this.addTitle("TitleWireFrame");var M=[];this.addLabelComboBox(M,N("editor.visible"),hteditor.getter("s","wf.visible"),function(M,Q){M.s("wf.visible",Q)},[!1,!0,"selected"]),this.addLabelCheckBox(M,N("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelColor(M,N("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(M,[this.indent,.1]),M=[],this.addLabelCheckBox(M,N("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),this.addLabelCheckBox(M,N("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelComboBox(M,N("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[N("editor.wfdontcombine"),N("editor.wfcombineadjacent"),N("editor.wfcombinecommon"),N("editor.wfcombinesmooth")]),this.addRow(M,[this.indent,.1])},Q.prototype.$19$=function(){this.addTitle("TitleShadow");var M=[];this.addLabelCheckBox(M,N("editor.shadow.cast"),hteditor.getter("s","shadow.cast"),hteditor.setter("s","shadow.cast")),this.addLabelCheckBox(M,N("editor.shadow.receive"),hteditor.getter("s","shadow.receive"),hteditor.setter("s","shadow.receive")),this.addRow(M,[this.indent,.1,this.indent2,.1])},Q}(e),d=hteditor.getString,MM=["all","front","back","left","right","top","bottom"],QM=function(M,Q,b){return function(Y){var I=Y.s(M+"."+Q);return b&&void 0===I?Y.s("all."+Q):I}},bM=function(M){return function(Q){var b=Q.s(M);return b||(b=Q.s("all.uv.scale")),b?b[0]:1}},YM=function(M){return function(Q,b){var Y=Q.s(M);Y||(Y=Q.s("all.uv.scale")),Q.s(M,[b,Y?Y[1]:1])}},IM=function(M){return function(Q){var b=Q.s(M);return b||(b=Q.s("all.uv.scale")),b?b[1]:1}},iM=function(M){return function(Q,b){var Y=Q.s(M);Y||(Y=Q.s("all.uv.scale")),Q.s(M,[Y?Y[0]:1,b])}},oM=function(M){return function(Q){Q.s(M,null)}},TM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Cube"))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.addCubeProperties()},Q.prototype.addCubeProperties=function(){var M=this;this.addTitle("TitleFace");var Q=void 0,b=void 0,Y=0,I=new ht.widget.TabView;b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++)!function(){var Y=MM[i]+".image";Q=[];var I=QM(MM[i],"image");M.addLabelImage(Q,d("editor.face."+MM[i]),function(Q){var b=I(Q),Y=M.editor.getFileNode(b);return Y?Y.url:b},hteditor.setter("s",Y)),b.addRow(Q,[M.indent,.1,20])}();L(I,d("editor.image"),b,!0),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var o=MM[i]+".uv.scale";Q=[],this.addLabel(Q,d("editor.face."+MM[i])),this.addButton(Q,null,d("editor.reset"),"editor.resetsize.state",oM(o)),this.addLabelInput(Q,"U",bM(o),YM(o),"number",1),this.addLabelInput(Q,"V",IM(o),iM(o),"number",1),b.addRow(Q,[this.indent-20-8,20,20,.1,20,.1])}L(I,d("editor.repeat"),b,!0),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var T=MM[i]+".color";Q=[],this.addLabelColor(Q,d("editor.face."+MM[i]),QM(MM[i],"color"),hteditor.setter("s",T)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.color"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var C=MM[i]+".transparent";Q=[],this.addLabelCheckBox(Q,d("editor.face."+MM[i]),QM(MM[i],"transparent"),hteditor.setter("s",C)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.transparent"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var R=MM[i]+".visible";Q=[],this.addLabelCheckBox(Q,d("editor.face."+MM[i]),QM(MM[i],"visible",!0),hteditor.setter("s",R)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.visible"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var t=MM[i]+".reverse.color";Q=[],this.addLabelColor(Q,d("editor.face."+MM[i]),QM(MM[i],"reverse.color"),hteditor.setter("s",t)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.reversecolor"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var G=MM[i]+".reverse.flip";Q=[],this.addLabelCheckBox(Q,d("editor.face."+MM[i]),QM(MM[i],"reverse.flip",!0),hteditor.setter("s",G)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.reverseflip"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var i=0;i<MM.length;i++){var X=MM[i]+".reverse.cull";Q=[],this.addLabelCheckBox(Q,d("editor.face."+MM[i]),QM(MM[i],"reverse.cull",!0),hteditor.setter("s",X)),b.addRow(Q,[this.indent,.1])}L(I,d("editor.reversecull"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight());var p=I.getTabHeight()+Y;Q=[],Q.push(I),this.addRow(Q,[.1],p)},Q}(v),CM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Cone"))}return f(Q,M),Q}(v),RM=hteditor.getString,tM=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],LM=["shape3d","shape3d.top","shape3d.bottom"],GM=function(M){return function(Q){var b=Q.s(M);return b?b[0]:1}},XM=function(M){return function(Q,b){var Y=Q.s(M);Q.s(M,[b,Y?Y[1]:1])}},pM=function(M){return function(Q){var b=Q.s(M);return b?b[1]:1}},sM=function(M){return function(Q,b){var Y=Q.s(M);Q.s(M,[Y?Y[0]:1,b])}},FM=function(M){return function(Q){Q.s(M,null)}},PM=function(M){function Q(b,Y){return S(this,Q),c(this,M.call(this,b,Y||"Shape3d"))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},Q.prototype.getCurrentPoint=function(M){return this.editor.currentPoint?this.editor.currentPoint[M]:0},Q.prototype.setCurrentPoint=function(M,Q){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(M,Q)},Q.prototype.addTopBodyBottomProperties=function(){var M=this;this.addTitle("TitleFace");var Q=void 0,b=void 0,Y=0,I=new ht.widget.TabView,i=this.faces;b=new ht.widget.FormPane;for(var o=0;o<i.length;o++)!function(){var Y=i[o]+".image";Q=[];var I=hteditor.getter("s",Y);M.addLabelImage(Q,RM("editor.face."+i[o]),function(Q){var b=I(Q),Y=M.editor.getFileNode(b);return Y?Y.url:b},hteditor.setter("s",Y)),b.addRow(Q,[M.indent,.1,20])}();L(I,RM("editor.image"),b,!0),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var o=0;o<i.length;o++){var T=i[o]+".uv.scale";Q=[],this.addLabel(Q,RM("editor.face."+i[o])),this.addButton(Q,null,RM("editor.reset"),"editor.resetsize.state",FM(T)),this.addLabelInput(Q,"U",GM(T),XM(T),"number",1),this.addLabelInput(Q,"V",pM(T),sM(T),"number",1),b.addRow(Q,[this.indent-20-8,20,20,.1,20,.1])}L(I,RM("editor.repeat"),b,!0),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var o=0;o<i.length;o++){var C=i[o]+".color";Q=[],this.addLabelColor(Q,RM("editor.face."+i[o]),hteditor.getter("s",C),hteditor.setter("s",C)),b.addRow(Q,[this.indent,.1,20])}L(I,RM("editor.color"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane;for(var o=0;o<i.length;o++){var R=i[o]+".visible";Q=[],this.addLabelCheckBox(Q,RM("editor.face."+i[o]),hteditor.getter("s",R),hteditor.setter("s",R)),b.addRow(Q,[this.indent,.1,20])}L(I,RM("editor.visible"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight()),b=new ht.widget.FormPane,Q=[],this.addLabelColor(Q,RM("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),b.addRow(Q,[this.indent,.1]),Q=[],this.addLabelCheckBox(Q,RM("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),b.addRow(Q,[this.indent,.1]),Q=[],this.addLabelCheckBox(Q,RM("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),b.addRow(Q,[this.indent,.1]),L(I,RM("editor.reverse"),b),b.validateImpl(),Y=Math.max(Y,b.getScrollHeight());var t=I.getTabHeight()+Y;Q=[],Q.push(I),this.addRow(Q,[.1],t)},Q.prototype.addEffectProperties=function(){this.addTitle("TitleEffect");var M=[];this.addLabelCheckBox(M,RM("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(M,[this.indent,.1]),M=[],this.addLabelColor(M,RM("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,RM("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,RM("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(M,[this.indent,.1]),this.simple||(M=[],this.addLabelRange(M,RM("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(M,[this.indent,.1]),M=[],this.addLabelRange(M,RM("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(M,[this.indent,.1]))},Q.prototype.addExtraProperties=function(M){},Z(Q,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?LM:tM}}]),Q}(v),_M=hteditor.getString,SM=function(M){function Q(b,Y){return S(this,Q),c(this,M.call(this,b,Y||"Cylinder"))}return f(Q,M),Q.prototype.addEffectProperties=function(){M.prototype.addEffectProperties.call(this);var Q=[];this.addLabelCheckBox(Q,_M("editor.smooth"),function(M){return M.s("shape3d.smooth")},function(M,Q){return M.s("shape3d.smooth",Q)}),this.addRow(Q,[this.indent,.1])},Q}(PM),ZM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"RoundRect"))}return f(Q,M),Q}(v),fM=hteditor.getString,cM=["shape3d","shape3d.from","shape3d.to"],zM=function(M){function Q(b,Y){return S(this,Q),c(this,M.call(this,b,Y||"Sphere"))}return f(Q,M),Q.prototype.addEffectProperties=function(){M.prototype.addEffectProperties.call(this);var Q=[];this.addLabelRange(Q,fM("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(Q,[this.indent,.1])},Z(Q,[{key:"faces",get:function(){return cM}}]),Q}(SM),nM=function(M){function Q(b,Y){return S(this,Q),c(this,M.call(this,b,Y||"Torus"))}return f(Q,M),Q}(zM),BM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Triangle"))}return f(Q,M),Q}(v),VM=hteditor.getString,kM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Model"))}return f(Q,M),Q.prototype.$11$=function(){var Q=this;M.prototype.$11$.call(this);var b=[];this.addLabelColor(b,VM("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelColor(b,VM("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,VM("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelCheckBox(b,VM("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addLabelCheckBox(b,VM("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addButton(b,VM("editor.resetposition"),null,null,function(M){var b=ht.Default.getShape3dModel(M.s("shape3d"));b&&b.center&&(Q.editor.beginTransaction(),M.setAnchor3d(.5,.5,.5),M.p3(b.center),Q.editor.endTransaction())}),this.addRow(b,[.1]).visible=function(){var M=Q.editor.ld;if(!M)return!1;var b=ht.Default.getShape3dModel(M.s("shape3d"));return b&&b.center}},Q}(v),KM=hteditor.getString,UM=hteditor.getter,HM=hteditor.setter,lM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Billboard"))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.addReflectorProperties()},Q.prototype.$11$=function(){var Q=this;M.prototype.$11$.call(this),this.addTitle("TitlePanel");var b=[];this.addLabelImage(b,KM("editor.image"),function(M){var b=M.s("shape3d.image"),Y=Q.editor.getFileNode(b);return Y?Y.url:b},function(M,b){M.s("shape3d.image",b),M.s("texture.cache")&&Q.editor.scene.invalidateShape3dCachedImage(M)}),this.addOneRow(b),b=[],this.addLabelCheckBox(b,KM("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelColor(b,KM("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelColor(b,KM("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelCheckBox(b,KM("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(b,KM("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(b,[this.indent,.1,this.indent2,.1])},Q.prototype.addReflectorProperties=function(){this.addTitle("TitleReflector");var M=[];this.addLabelCheckBox(M,KM("editor.reflector"),UM("s","shape3d.reflector"),HM("s","shape3d.reflector")),this.addRow(M,[this.indent,.1]),M=[],this.addLabelColor(M,KM("editor.reflectorcolor"),UM("s","shape3d.reflector.color"),HM("s","shape3d.reflector.color")),this.addRow(M,[this.indent,.1])},Q}(v),OM=hteditor.getString,mM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Wall"))}return f(Q,M),Q.prototype.$11$=function(){M.prototype.$11$.call(this);var Q=[];this.addLabelCheckBox(Q,OM("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(Q,[this.indent,.1])},Q.prototype.addTransformProperties=function(){M.prototype.addTransformProperties.call(this);var Q=[];this.addLabelRange(Q,OM("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(Q,OM("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(Q,OM("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(Q,[this.indent,.1,30,.1,30,.1])},Q}(TM),$M=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Floor"))}return f(Q,M),Q}(SM),wM=hteditor.getString,gM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Pipeline"))}return f(Q,M),Q.prototype.addTransformProperties=function(){M.prototype.addTransformProperties.call(this);var Q=[];this.addLabelRange(Q,wM("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(Q,wM("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(Q,wM("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(Q,[this.indent,.1,30,.1,30,.1])},Q.prototype.addExtraProperties=function(Q){M.prototype.addExtraProperties.call(this);var b=[];this.addLabelInput(b,wM("editor.startangle"),function(M){return Math.round(180/Math.PI*M.s("shape3d.start.angle"))},function(M,Q){M.s("shape3d.start.angle",Q*Math.PI/180)},"int",1),Q.addRow(b,[this.indent,.1]),b=[],this.addLabelInput(b,wM("editor.sweepangle"),function(M){return Math.round(180/Math.PI*M.s("shape3d.sweep.angle"))},function(M,Q){M.s("shape3d.sweep.angle",Q*Math.PI/180)},"int",1),Q.addRow(b,[this.indent,.1])},Z(Q,[{key:"simple",get:function(){return!0}}]),Q}(PM),uM=hteditor.getString,JM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Polyline"))}return f(Q,M),Q.prototype.addTransformProperties=function(){var Q=this;M.prototype.addTransformProperties.call(this);var b=[];this.addLabelRange(b,uM("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(b,uM("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(b,uM("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(b,[this.indent,.1,30,.1,30,.1]),b=[],b.push(uM("editor.point")),this.addButton(b,null,uM("editor.reset"),"editor.resetsize.state",function(M){Q.setCurrentPoint("e",0)}),this.addLabelInput(b,"X",function(M){return Q.getCurrentPoint("x")},function(M,b){Q.setCurrentPoint("x",b)},"int",1),this.addLabelInput(b,"Y",function(M){return Q.getCurrentPoint("e")},function(M,b){Q.setCurrentPoint("e",b)},"int",1),this.addLabelInput(b,"Z",function(M){return Q.getCurrentPoint("y")},function(M,b){Q.setCurrentPoint("y",b)},"int",1),this.addRow(b,[this.indent-40-8,20,20,.1,20,.1,20,.1])},Z(Q,[{key:"simple",get:function(){return!0}}]),Q}(PM),WM=hteditor.getString,AM=function(M){return function(Q){var b=Q.s(M);return b?b[0]:1}},EM=function(M){return function(Q,b){var Y=Q.s(M);Q.s(M,[b,Y?Y[1]:1])}},rM=function(M){return function(Q){var b=Q.s(M);return b?b[1]:1}},aM=function(M){return function(Q,b){var Y=Q.s(M);Q.s(M,[Y?Y[0]:1,b])}},jM=function(M){return function(Q){Q.s(M,null)}},qM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Edge"))}return f(Q,M),Q.prototype.initForm=function(){M.prototype.initForm.call(this),this.$88$(),this.$90$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},Q.prototype.$11$=function(){var M=this;this.addTitle("TitleBasic");var Q=[];this.addLabelInput(Q,WM("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(Q,WM("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelURL(Q,WM("editor.navigate"),function(M){return M.a("navigate")||""},function(M,Q){M.a("navigate",Q)},function(M,Q){var b=Q.view.draggingData;return b&&("scene"===b.fileType||"display"===b.fileType)}),this.addLabelInput(Q,WM("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelComboBoxURL(Q,WM("editor.type"),function(Q){var b=Q.s("shape3d");if(T(b)){var Y=M.editor.getFileNode(b);return Y?Y.url:b}return b},function(Q,b){Q.s("shape3d",b),M.editor.updateInspector()},["","cylinder"],void 0,void 0,function(M,Q){return!!Q.view.draggingData&&"model"===Q.view.draggingData.fileType}),this.addImage(Q,function(M){return M.s("shape3d")},void 0,function(M){return hteditor.isJSON(M)?M.substr(0,M.length-5)+".png":null},function(M){return hteditor.isJSON(M.rawIcon)}),this.addOneRow(Q),Q=[],this.addLabelCheckBox(Q,WM("editor.selectable"),function(M){return M.s("3d.selectable")},function(M,Q){M.s("2d.selectable",Q),M.s("3d.selectable",Q)}),this.addLabelCheckBox(Q,WM("editor.movable"),function(M){return M.s("3d.movable")},function(M,Q){M.s("2d.movable",Q),M.s("3d.movable",Q)}),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelCheckBox(Q,WM("editor.editable"),function(M){return M.s("3d.editable")},function(M,Q){M.s("2d.editable",Q),M.s("3d.editable",Q)}),this.addLabelCheckBox(Q,WM("editor.visible"),function(M){return M.s("3d.visible")},function(M,Q){M.s("2d.visible",Q),M.s("3d.visible",Q)}),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelCheckBox(Q,WM("editor.interactive"),function(M){return M.s("interactive")},function(M,Q){return M.s("interactive",Q)}),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelRange(Q,WM("editor.envmap"),function(M){return M.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelRange(Q,WM("editor.brightness"),function(M){return M.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelObject(Q,WM("editor.polygonoffset"),function(M){return M.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(Q,[this.indent,.1])},Q.prototype.addTransformProperties=function(){},Q.prototype.$88$=function(){var M=this;this.addTitle("TitleEdgeBasic");var Q=[];this.addLabelComboBox(Q,WM("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(Q,[this.indent,.1]),Q=[],this.addLabelInput(Q,WM("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(Q,WM("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelInput(Q,WM("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(Q,WM("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[],this.addLabelColor(Q,WM("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(Q,WM("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(Q,[this.indent,.1,this.indent2,.1]),Q=[];var b=hteditor.getter("s","shape3d.image");this.addLabelImage(Q,WM("editor.image"),function(Q){var Y=b(Q),I=M.editor.getFileNode(Y);return I?I.url:Y},hteditor.setter("s","shape3d.image")),this.addRow(Q,[this.indent,.1,20]),Q=[],this.addLabel(Q,"UV"),this.addButton(Q,null,WM("editor.reset"),"editor.resetsize.state",jM("shape3d.uv.scale")),this.addLabelInput(Q,"U",AM("shape3d.uv.scale"),EM("shape3d.uv.scale"),"number",1),this.addLabelInput(Q,"V",rM("shape3d.uv.scale"),aM("shape3d.uv.scale"),"number",1),this.addRow(Q,[this.indent-20-8,20,20,.1,20,.1]),Q=[],this.addLabel(Q,"UV "+WM("editor.offset")),this.addButton(Q,null,WM("editor.reset"),"editor.resetsize.state",jM("shape3d.uv.offset")),this.addLabelInput(Q,"U",function(M){return(M.s("shape3d.uv.offset")||[0,0])[0]},function(M,Q){var b=M.s("shape3d.uv.offset")||[];M.s("shape3d.uv.offset",[Q,b[1]])},"number",.1),this.addLabelInput(Q,"V",function(M){return(M.s("shape3d.uv.offset")||[0,0])[1]},function(M,Q){var b=M.s("shape3d.uv.offset")||[];M.s("shape3d.uv.offset",[b[0],Q])},"number",.1),this.addRow(Q,[this.indent-20-8,20,20,.1,20,.1])},Q.prototype.$90$=function(){},Q.prototype.addEdgeSourceNodeProperties=function(){var M=p.config.numberPrecision;this.addTitle("TitleEdgeSourceNode");var Q=[];this.addLabelData(Q,WM("editor.node"),hteditor.getter("p","source"),function(M,Q){M instanceof ht.Edge&&(null==Q||Q instanceof ht.Node||Q instanceof ht.Edge)&&(M.setSource(Q),M.s("edge.source.percent",.5))}),this.addRow(Q,[this.indent,.1,20]);var b=M.anchor||0,Y=0===b?"int":"number",I=1/Math.pow(10,b);Q=[],Q.push(WM("editor.anchor")),this.addButton(Q,null,WM("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Edge&&M.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(Q,"X",function(M){var Q=M.s("edge.source.anchor.x");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.source.anchor.x",parseFloat(Q))},Y,I),this.addLabelInput(Q,"Y",function(M){var Q=M.s("edge.source.anchor.elevation");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.source.anchor.elevation",parseFloat(Q))},Y,I),this.addLabelInput(Q,"Z",function(M){var Q=M.s("edge.source.anchor.y");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.source.anchor.y",parseFloat(Q))},Y,I),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1])},Q.prototype.addEdgeTargetNodeProperties=function(){var M=p.config.numberPrecision;this.addTitle("TitleEdgeTargetNode");var Q=[];this.addLabelData(Q,WM("editor.node"),hteditor.getter("p","target"),function(M,Q){M instanceof ht.Edge&&(null==Q||Q instanceof ht.Node||Q instanceof ht.Edge)&&(M.setTarget(Q),M.s("edge.target.percent",.5))}),this.addRow(Q,[this.indent,.1,20]);var b=M.anchor||0,Y=0===b?"int":"number",I=1/Math.pow(10,b);Q=[],Q.push(WM("editor.anchor")),this.addButton(Q,null,WM("editor.reset"),"editor.resetsize.state",function(M){M instanceof ht.Edge&&M.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(Q,"X",function(M){var Q=M.s("edge.target.anchor.x");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.target.anchor.x",parseFloat(Q))},Y,I),this.addLabelInput(Q,"Y",function(M){var Q=M.s("edge.target.anchor.elevation");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.target.anchor.elevation",parseFloat(Q))},Y,I),this.addLabelInput(Q,"Z",function(M){var Q=M.s("edge.target.anchor.y");return null==Q&&(Q=.5),Number(Q.toFixed(b))},function(M,Q){M instanceof ht.Edge&&M.s("edge.target.anchor.y",parseFloat(Q))},Y,I),this.addRow(Q,[this.indent-40-8,20,20,.1,20,.1,20,.1])},Q}(v),yM=["edit_tx","edit_ty","edit_tz","edit_rx","edit_ry","edit_rz","edit_sx","edit_sy","edit_sz"],eM=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this,b));return Y.keep=!0,Y}return f(Q,M),Q.prototype.handle_touchstart=function(Q){M.prototype.handle_touchstart.call(this,Q);var b=this.getState();if(!("move"===b||yM.indexOf(b)>=0||"select"===b)){var Y=ht.Default.isLeftButton(Q),I=ht.Default.isMiddleButton(Q),i=1===ht.Default.getTouchCount(Q);(Y||I)&&i&&this.setState("pan")}},Q}(ht.graph3d.DefaultInteractor),DM=hteditor.getString,xM=ht.Default.createBoxModel();ht.Default.handleUnfoundModel=function(){return xM};var NM=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b;var I=[];return I.push({label:DM("editor.save"),action:function(){Y.ok()}}),I.push({label:DM("editor.save.import"),action:function(){Y.ok(!0)}}),I.push({label:DM("editor.cancel"),action:function(){Y.hide()}}),Y.dm=new ht.DataModel,Y.node=new ht.Node,Y.node.s({"wf.visible":"selected","select.brightness":1}),Y.node.setAnchor3d(.5,0,.5),Y.dm.add(Y.node),Y.g3d=new ht.graph3d.Graph3dView(Y.dm),Y.formPane=Y.createFromPane(),Y.splitView=new ht.widget.SplitView(Y.g3d,Y.formPane,"h",.55),Y.setConfig({title:DM("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:Y.splitView,buttons:I,buttonsAlign:"right"}),Y.setModal(!1),b.addEventListener(function(M){if("fileChanged"===M.type){var Q=M.params.path,b=Y.g3d;b.getTextureMap()[Q]&&b.deleteTexture(Q),document.body.contains(b.getView())&&b.invalidateAll()}}),Y}return f(Q,M),Q.prototype.toJSON=function(){var M={modelType:"obj"},Q=M.obj=this.formPane.v("obj");if(!Q||!I(Q))return void this.showError("obj");var b=M.mtl=this.formPane.v("mtl");return b&&!i(b)?void this.showError("mtl"):(M.image=this.formPane.v("imageURL"),M.prefix=this.formPane.v("prefix"),M.center=this.formPane.v("center"),this.formPane.v("reverseFlipMtls")&&(M.reverseFlipMtls="*"),M.ignoreImage=!!this.formPane.v("ignoreImage"),M.ignoreColor=!!this.formPane.v("ignoreColor"),
M.s3=[Number(this.formPane.v("sX")),Number(this.formPane.v("sY")),Number(this.formPane.v("sZ"))],M.r3=[Number(this.formPane.v("rX")),Number(this.formPane.v("rY")),Number(this.formPane.v("rZ"))],M.image||delete M.image,M.prefix||delete M.prefix,M.center&&delete M.center,M.ignoreImage||delete M.ignoreImage,M.ignoreColor||delete M.ignoreColor,"1,1,1"===M.s3.toString()&&delete M.s3,"0,0,0"===M.r3.toString()&&delete M.r3,M)},Q.prototype.ok=function(M){var Q=this,b=this.toJSON();if(b){var Y=this.formPane.v("url");if(!Y)return void this.showError("name");Y=this.editor.models.currentDir+"/"+Y+".json",this.json=b;var I={path:Y,content:ht.Default.stringify(this.json)};this.editor.request("upload",I,function(b){if(Q.editor.saveImage(Q.g3d,Y.substr(0,Y.length-5)+".png",function(){Q.hide()}),M){var I=new ht.Node;I.s("shape3d",Y),I.setAnchor3d([.5,0,.5]),Q.editor.dm.add(I),Q.editor.sm.ss(I)}var i=Q.node,o=i.s("shape3d");o&&ht.Default.setShape3dModel(o.uuid,void 0),i.s("shape3d","box")})}},Q.prototype.open=function(M,Q){var b=this;this.isShowing()||(this.show(),this.__oldHandleModelLoadedFunc__=ht.Default.handleModelLoaded,ht.Default.handleModelLoaded=function(M,Q){var Y=b.node.s("shape3d");C(Y)&&(Y=Y.uuid),M===Y&&b.updateScene(Q)}),this.url=M,this.json=Q,this.node.s("shape3d",M),this.node.p3(0,0,0),this.g3d.reset(),this.update()},Q.prototype.hide=function(){M.prototype.hide.call(this),ht.Default.handleModelLoaded=this.__oldHandleModelLoadedFunc__,this.__oldHandleModelLoadedFunc__=null},Q.prototype.update=function(){var M=this.json;if(this.url){var Q=this.editor.models.ld,b=Q.s("label");this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",b);var Y=ht.Default.getShape3dModel(this.url);Y&&(this.updateScene(Y),M=this.json=ht.Default.parse(ht.Default.stringify(Y.json)))}else this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url","");M||(M={}),this.formPane.v("obj",M.obj||""),this.formPane.v("mtl",M.mtl||""),this.formPane.v("imageURL",M.image||""),this.formPane.v("prefix",M.prefix||""),this.formPane.v("reverseFlipMtls",!!M.reverseFlipMtls),this.formPane.v("center",void 0==M.center),this.formPane.v("ignoreImage",!!M.ignoreImage),this.formPane.v("ignoreColor",!!M.ignoreColor);var I=M.s3||[1,1,1];this.formPane.v("sX",I[0]),this.formPane.v("sY",I[1]),this.formPane.v("sZ",I[2]);var i=M.r3||[0,0,0];this.formPane.v("rX",i[0]),this.formPane.v("rY",i[1]),this.formPane.v("rZ",i[2]),this.formPane.getItemById("image").element.setIcon(M.image)},Q.prototype.createFromPane=function(){var M=this,Q=new ht.widget.FormPane;Q.addRow([{element:DM("editor.name")},{id:"url",textField:{}}],[60,.1]),Q.addRow([{element:"obj"},{id:"obj",textField:{handleChange:function(Q){if(!Q)return M.resetModel(),void M.clearInput();M.autoFillInput("obj",Q)&&M.updateModel()}}},{image:{icon:"editor.obj",onClicked:function(b){M.editor.selectFileNode(Q.v("obj"))}}}],[60,.1,20]);var b=Q.getViewById("obj");this.handleDragAndDrop(b,function(M,Q){return!!Q.view.draggingData&&I(Q.view.draggingData.getFileUUID())}),Q.addRow([{element:"mtl"},{id:"mtl",textField:{handleChange:function(Q){Q&&!M.autoFillInput("mtl",Q)||M.updateModel()}}},{image:{icon:"editor.mtl",onClicked:function(b){M.editor.selectFileNode(Q.v("mtl"))}}}],[60,.1,20]);var Y=Q.getViewById("mtl");this.handleDragAndDrop(Y,function(M,Q){return!!Q.view.draggingData&&i(Q.view.draggingData.getFileUUID())}),Q.addRow([{element:DM("editor.imageprefix")},{id:"prefix",textField:{handleChange:function(){M.updateModel()}}}],[60,.1]),this.handleBlurAndKeydown(Q.getViewById("prefix").getElement(),function(Q){M.updateModel()}),Q.addRow([{element:DM("editor.reverseFlipMtls")},{id:"reverseFlipMtls",checkBox:{onClicked:function(){M.updateModel()}}},{element:DM("editor.modelcenter"),align:"right"},{id:"center",checkBox:{onClicked:function(){M.updateModel()}}}],[60,.1,60,.1]),Q.addRow([{element:DM("editor.modelignoreImage")},{id:"ignoreImage",checkBox:{onClicked:function(){M.updateModel()}}},{element:DM("editor.modelignoreColor"),align:"right"},{id:"ignoreColor",checkBox:{onClicked:function(){M.updateModel()}}}],[60,.1,60,.1]),Q.addRow([],[.1],1.01,{background:"#E4E4E4"}),Q.addRow([null,"X","Y","Z"],[60,.1,.1,.1]),Q.addRow([DM("editor.scale"),{id:"sX",textField:{type:"number"}},{id:"sY",textField:{type:"number"}},{id:"sZ",textField:{type:"number"}}],[60,.1,.1,.1]);var o=p.config.numberPrecision,T=o.rotation||0;return Q.addRow([DM("editor.rotation"),{id:"rX",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(M){this.setText((M/Math.PI*180).toFixed(T))},type:"number"}},{id:"rY",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(M){this.setText((M/Math.PI*180).toFixed(T))},type:"number"}},{id:"rZ",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(M){this.setText((M/Math.PI*180).toFixed(T))},type:"number"}}],[60,.1,.1,.1]),["s","r"].forEach(function(b){["X","Y","Z"].forEach(function(Y){var I=Q.getViewById(b+Y).getElement();I.onblur=function(){return M.updateModel()},I.onkeydown=function(Q){ht.Default.isEnter(Q)&&M.updateModel()}})}),Q.addRow([],[.1],1.01,{background:"#E4E4E4"}),Q.addRow([{element:DM("editor.image")},{id:"imageURL",textField:{}}],[60,.1]),Q.addRow([{id:"image",image:{}}],[.1],70),this.handleBlurAndKeydown(Q.getViewById("imageURL").getElement(),function(Q){M.formPane.getItemById("image").element.setIcon(Q)}),Q},Q.prototype.updateModel=function(){var M=this.toJSON();M&&(void 0==M.center&&(M.center=!0),this.setModel(M))},Q.prototype.handleDragAndDrop=function(M,Q){function b(){Y.style.border=I,I=null}var Y=M.getElement();M.isDroppable=Q;var I=void 0;M.handleCrossDrag=function(Q,i,o){if("enter"===i)I=Y.style.border,Y.style.border="solid "+p.config.color_select_dark+" 2px";else if("exit"===i||"cancel"===i)b();else if("over"===i);else if("drop"===i){var T=Y.value;Y.value=o.view.draggingData.getFileUUID(),b(),M.setFocus(),M.handleChange(Y.value,T)}},this.handleBlurAndKeydown(Y,function(Q){M.handleChange(Q)})},Q.prototype.handleBlurAndKeydown=function(M,Q){M.onblur=function(b){Q(M.value)},M.onkeydown=function(b){ht.Default.isEnter(b)&&Q(M.value)}},Q.prototype.autoFillInput=function(M,Q){if(!this.__error__){if(Q.length<=4)return this.showError(M),!1;var b=this.formPane,Y=Q.length,I=Q.lastIndexOf("/")+1,i=Q.substr(0,Y-4).substr(I),o=b.v("url"),T=b.v("obj"),C=b.v("mtl"),R=b.v("prefix");return o||b.v("url",i),"obj"===M?C||b.v("mtl",Q.substr(0,Y-3)+"mtl"):"mtl"===M&&(T||b.v("obj",Q.substr(0,Y-3)+"obj")),R||b.v("prefix",Q.substr(0,I)),!0}},Q.prototype.showError=function(M){var Q=this;if(!this.__error__){var b=void 0;"name"===M?b=DM("editor.error.name"):"obj"!==M&&"mtl"!==M||(b=DM("editor.error."+M+".file")),this.__error__=!0,hteditor.alert(DM("editor.error.title"),b,function(){ht.Default.callLater(function(){return Q.__error__=!1})})}},Q.prototype.resetModel=function(){this.setModel("box")},Q.prototype.setModel=function(M){var Q=R(M)?M:JSON.stringify(M);if(this._currentJSON!==Q){var b=this.node,Y=b.s("shape3d");Y&&C(Y)&&ht.Default.setShape3dModel(Y.uuid,void 0),b.s("shape3d",M),this._currentJSON=Q}},Q.prototype.clearInput=function(){var M=this.formPane;M.v("obj",""),M.v("mtl",""),M.v("prefix",""),M.getViewById("url").isEditable()&&M.v("url","")},Q.prototype.updateScene=function(M){if(M&&M.rawS3){var Q=this.g3d,b=M.rawS3[0],Y=M.rawS3[1],I=M.rawS3[2],i=Math.max(Y,b/(Q.getAspect()||1)),o=i/2/Math.tan(Q.getFovy()/2);o=2*Math.max(I/2,o),Q.setEye(0,Y/2,o),Q.setCenter(0,Y/2,0),Q.setNear(Math.min(10,o/4)),Q.setFar(Math.max(1e4,4*o))}},Q}(ht.widget.Dialog),hM=hteditor.getString,vM=function(M){function Q(b){return S(this,Q),c(this,M.call(this,b,"Block"))}return f(Q,M),Q.prototype.$19$=function(){},Q.prototype.$11$=function(){this.addTitle("TitleBasic"),this.addEventProperties();var M=[];this.addLabelInput(M,hM("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(M,hM("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelInput(M,hM("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(M,[this.indent,.1]),M=[],this.addLabelCheckBox(M,hM("editor.selectable"),function(M){return M.s("3d.selectable")},function(M,Q){M.s("2d.selectable",Q),M.s("3d.selectable",Q)}),this.addLabelCheckBox(M,hM("editor.movable"),function(M){return M.s("3d.movable")},function(M,Q){M.s("2d.movable",Q),M.s("3d.movable",Q)}),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelCheckBox(M,hM("editor.editable"),function(M){return M.s("3d.editable")},function(M,Q){M.s("2d.editable",Q),M.s("3d.editable",Q)}),this.addLabelCheckBox(M,hM("editor.visible"),function(M){return M.s("3d.visible")},function(M,Q){M.s("2d.visible",Q),M.s("3d.visible",Q)}),this.addRow(M,[this.indent,.1,this.indent2,.1]),M=[],this.addLabelCheckBox(M,hM("editor.clickthroughenabled"),function(M){return M.isClickThroughEnabled()},function(M,Q){return M.setClickThroughEnabled(Q)}),this.addLabelCheckBox(M,hM("editor.syncsize"),function(M){return M.isSyncSize()},function(M,Q){return M.setSyncSize(Q)}),this.addRow(M,[this.indent,.1,this.indent2,.1])},Q}(v),dM={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(M,Q){if(M instanceof ht.Block)return null;if(M instanceof ht.Node){var b=M.s("shape3d");if(ht.Default.isString(b)&&hteditor.isJSON(b))return null}return hteditor.config.color_dark}},name:{func:function(M,Q){if(M instanceof ht.Block)return"editor.block";if(M instanceof ht.Shape)return M.getThickness()>0?"editor.wall":"editor.floor";if(M instanceof ht.Node){var b=M.s("shape3d");if(b){if(ht.Default.isString(b)&&hteditor.isJSON(b))return b.substr(0,b.length-4)+"png";if("sphere"===b)return"editor.sphere";if("cylinder"===b)return"editor.cylinder"}return"editor.cube"}return M.getIcon()}},rect:[0,0,20,16]}]},MQ=hteditor.getString,QQ=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this,b,b.dm));return Y.initMenu(),Y}return f(Q,M),Q.prototype.handleDelete=function(){this.removeSelection()},Q.prototype.onDataDoubleClicked=function(M,Q){Q.altKey?this.editor.gv.fitData(M,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(M,!0),this.editor.scene.flyTo(M,{animation:!0}))},Q.prototype.getLabel=function(Q){var b=M.prototype.getLabel.call(this,Q);if(!b){var Y=Q.s("shape3d");if(Q instanceof ht.Block)b=MQ(Q.getClassName());else if(Q instanceof ht.Shape)b=MQ("cylinder"===Y?"editor.pipeline":Q.getThickness()>0?"editor.wall":"editor.floor");else if(Q instanceof ht.Node){var I="editor."+(Y||"cube");if(!(b=MQ(I))||I===b)if(hteditor.isJSON(Y)){var i=this.editor.getFileNode(Y),o=i?i.getName():Y;b=hteditor.fileNameToDisplayName(o)}else b=Y}b||(b=MQ("editor.cube"))}return b||""},Q.prototype.getIcon=function(M){return dM},Q.prototype._endDrag=function(M,Q){var b=this,Y=Q.type,I=Q.parent,i=Q.refData;if(this.isSelected(this.draggingData)){var o=this.getTopRowOrderSelection();"down"===Y&&o.reverse(),o.each(function(M){b._dropData(M,Y,I,i)})}else this._dropData(this.draggingData,Y,I,i),this.sm().ss(this.draggingData);I&&this.expand(I)},Q.prototype._dropData=function(M,Q,b,Y){if(M.setParent(b),"down"===Q||"up"===Q){var I=b?b.getChildren():this.dm().getRoots(),i=I.indexOf(Y);"down"===Q&&i++,I.indexOf(M)<i&&i--,this.dm().moveTo(M,i)}else b||this.dm().moveToBottom(M)},Q.prototype.isEditable=function(M){return!0},Q.prototype.rename=function(M,Q){M.setDisplayName(Q)},Q.prototype.initMenu=function(){this.menu=new ht.widget.ContextMenu;var M=[],Q=this.editor;this.addSelectDescendantItems(M),this.addBlockItems(M),this.menu.setItems(M),this.menu.addTo(this.getView()),Q.menus.push(this.menu)},Q.prototype.onPropertyChanged=function(Q){"filter"===Q.property&&(this.visibleMap=null,this.ivm()),M.prototype.onPropertyChanged.call(this,Q)},Q.prototype.handleDataPropertyChange=function(Q){!this._filter||"name"!==Q.property&&"displayName"!==Q.property?M.prototype.handleDataPropertyChange.call(this,Q):(this.visibleMap=null,this.ivm())},Q.prototype.checkVisible=function(M){if(!this._filter)return!0;if(p.config.sceneTreeVisibleFunc)return p.config.sceneTreeVisibleFunc(M,this._filter);var Q=this.getLabel(M),b=(this._filter+"").toLowerCase();return null!=Q&&(Q=(Q+"").toLowerCase(),Q.indexOf(b)>=0)},Q.prototype.validateModel=function(){var Q=this;this._filter&&!this.visibleMap&&(this.visibleMap={},this.getDataModel().each(function(M){if(Q.checkVisible(M)){Q.visibleMap[M._id]=!0;for(var b=M.getParent();b&&!Q.visibleMap[b._id];)Q.visibleMap[b._id]=!0,b=b.getParent()}})),M.prototype.validateModel.call(this)},Q.prototype.isVisible=function(M,Q){if(!Q&&M._refGraph)return!1;var b=this.getVisibleFunc();return!(b&&!b(M))&&(!this._filter||this.visibleMap&&this.visibleMap[M._id])},Q}(hteditor.DNDTree);hteditor.msClass(QQ,{ms_ac:["filter"]});var bQ=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b,Y.tree=new QQ(b),Y.setCenterView(Y.tree),Y.controlPane=new ht.widget.FormPane,Y.controlPane.addRow([{id:"filter",textField:{}}],[.1,ht.Default.isTouchable?32:18]),Y.setBottomView(Y.controlPane),Y.setBottomHeight(ht.Default.widgetRowHeight+8);var I=!1,i=Y.input=Y.controlPane.getViewById("filter").getElement();return i.addEventListener("compositionstart",function(){return I=!0}),i.addEventListener("compositionend",function(){return I=!1}),i.addEventListener("keyup",function(M){I||(ht.Default.isEsc(M)&&(i.value=""),Y.tree.setFilter(i.value))}),Y}return f(Q,M),Q}(ht.widget.BorderPane),YQ=hteditor.getString,IQ=hteditor.getter,iQ=hteditor.setter,oQ=hteditor.createCodeEditor,TQ=ht.Default.clone,CQ=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b,Y._updateHandles=[],(Y.batchInfoDialog=new tQ(b)).handleComplete=function(M){var Q=Y.sm.ld();Q&&Q.a("batchInfo",M)};var I=Y._tablePane=new ht.widget.TablePane;return Y.initTable(),Y.addRow([YQ("editor.batchbrightness"),Y.addChickBox(function(){return!Y.editor.dm.a("sceneBatchBrightnessDisabled")},function(M){return Y.editor.dm.a("sceneBatchBrightnessDisabled",!M)}),YQ("editor.batchblend"),Y.addChickBox(function(){return!Y.editor.dm.a("sceneBatchBlendDisabled")},function(M){return Y.editor.dm.a("sceneBatchBlendDisabled",!M)})],[80,.1,80,.1]),Y.addRow([I],[.1],.1),Y.addRow([{button:{icon:"editor.add",toolTip:YQ("editor.add"),onClicked:function(){Y.addData()}}},{button:{icon:"editor.delete",toolTip:YQ("editor.delete"),onClicked:function(){Y.sm.size()&&Y.sm.removeSelection()}}}],[20,20]),Y}return f(Q,M),Q.prototype.isNameExist=function(M,Q){for(var b=!1,Y=this.dm.getDatas(),I=0,i=Y.size();I<i;I++){var o=Y.get(I);if(o!==Q&&(b=o.a("name")===M))break}return b},Q.prototype.onDataPropertyChanged=function(M){if(!this._parsing){var Q=M.property,b=M.data,Y=M.newValue,I=M.oldValue;if("a:name"===Q){if(this.isNameExist(Y,b))return void b.a("name",I);if(I){delete ht.Default.getBatchInfoMap()[I]}var i=b.a("batchInfo");if(i&&ht.Default.getBatchInfo(Y)===i)return;ht.Default.setBatchInfo(Y,i),this.editor.scene.invalidateBatch(Y)}else if("a:batchInfo"===Q){var o=b.a("name");if(!o)return;ht.Default.setBatchInfo(o,Y),this.editor.scene.invalidateBatch(o)}}},Q.prototype.onDataModelChanged=function(M){this._parsing||ht.Default.setBatchInfoMap(this.toBatchInfoMap())},Q.prototype.initTable=function(){var M=this,Q=this._tablePane;return Q.getTableView().setEditable(!0),Q.addColumns([this.$73$("name",YQ("editor.name"),80),this.$73$("batchInfo",YQ("editor.batchInfo"),200)]),Q.getColumnModel().getDataByTag("batchInfo").isCellEditable=function(Q,b,Y,I){return M.batchInfoDialog.parseBatchInfo(Q.a("batchInfo")),M.batchInfoDialog.show(),!1},this.dm.md(this.onDataPropertyChanged,this),this.dm.mm(this.onDataModelChanged,this),Q},Q.prototype.$73$=function(M,Q,b){return{name:M,tag:M,width:b,displayName:Q,align:"center",editable:!0,accessType:"attr"}},Q.prototype.toBatchInfoMap=function(){var M={};return this.dm.each(function(Q){var b=Q.a("name");b&&(M[b]=Q.a("batchInfo"))}),M},Q.prototype.addData=function(M){var Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=new ht.Data;b.a({name:M,batchInfo:Q}),this.dm.add(b)},Q.prototype.parseBatchInfoMap=function(M){this._parsing=!0;for(var Q in M)this.addData(Q,M[Q]);this._parsing=!1},Q.prototype.clearBatchInfo=function(){this.dm.clear(),this.updateProperties()},Q.prototype.addChickBox=function(M,Q){var b=this,Y=new ht.widget.CheckBox;return Y.getValue=M,Y.setValue(M()),Y.onValueChanged=function(M,Y){b._updatting||Q(Y)},this._updateHandles.push(function(){Y.setValue(M())}),Y},Q.prototype.updateProperties=function(){this._updatting=!0,this._updateHandles.forEach(function(M){return M()}),this._updatting=!1},Z(Q,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"keys",get:function(){var M=[void 0];return this.dm.each(function(Q){return M.push(Q.a("name"))}),M}}]),Q}(ht.widget.FormPane),RQ={alphaTest:ht.Style.alphaTest,brightness:!1,blend:!1,color:void 0,image:void 0,light:!0,reverseCull:!1,reverseFlip:!1,reverseColor:ht.Color.reverse,transparentMask:ht.Style["transparent.mask"],uvOffset:0,uvScale:1,discardSelectable:!0,opacity:1,transparent:!1,autoSort:!0},tQ=function(M){function Q(b){S(this,Q);var Y=c(this,M.call(this));Y.editor=b;var I=Y._tabView=Y.initTabView(),i=Y.initButtons();return Y.setConfig({title:YQ("editor.batchInfo"),closable:!0,draggable:!0,width:415,height:485,contentPadding:6,resizeMode:"wh",maximizable:!0,content:I,buttons:i,buttonsAlign:"right"}),Y.setModal(!1),Y}return f(Q,M),Q.prototype.initTabView=function(){var M=this,Q=new ht.widget.TabView,b=this._commonView=this.initCommonView(),Y=this._commonTab=Q.add(YQ("editor.common"),b,!0),I=this._advanceView=this.initAdvanceView(),i=this._advanceTab=Q.add(YQ("editor.advance"),I),o=Q.getTabModel().sm();return o.ms(function(){var Q=o.ld();Q===Y?M.parseBatchInfo(JSON.parse(I.getValue())):Q===i&&I.setValue(JSON.stringify(b.data.getAttrObject(),function(M,Q){return void 0===Q?null:Q},4))}),Q},Q.prototype.initCommonView=function(){var M=new e(this.editor,"batchInfo","data");M.setLabelVPadding(0),M.getValue=function(M){return M(this.data)},M.setValue=function(M,Q,b){M(this.data,b?b():Q)},(M.data=new ht.Data).onPropertyChanged=function(Q){return M.updateProperties()};var Q=[];return M.addLabelRange(Q,YQ("editor.alphatest"),IQ("a","alphaTest"),iQ("a","alphaTest"),0,1,.01,"number"),M.addNameRow(Q,"alphaTest","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.brightness"),IQ("a","brightness"),iQ("a","brightness")),M.addNameRow(Q,"brightness","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.blend"),IQ("a","blend"),iQ("a","blend")),M.addNameRow(Q,"blend","a"),Q=[],M.addLabelColor(Q,YQ("editor.color"),IQ("a","color"),iQ("a","color")),M.addNameRow(Q,"color","a"),Q=[],M.addLabelImage(Q,YQ("editor.image"),IQ("a","image"),iQ("a","image")),M.addNameRow(Q,"image","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.light"),IQ("a","light"),iQ("a","light")),M.addNameRow(Q,"light","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.reversecull"),IQ("a","reverseCull"),iQ("a","reverseCull")),M.addNameRow(Q,"reverseCull","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.reverseflip"),IQ("a","reverseFlip"),iQ("a","reverseFlip")),M.addNameRow(Q,"reverseFlip","a"),Q=[],M.addLabelColor(Q,YQ("editor.reversecolor"),IQ("a","reverseColor"),iQ("a","reverseColor")),M.addNameRow(Q,"reverseColor","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.transparentmask"),IQ("a","transparentMask"),iQ("a","transparentMask")),M.addNameRow(Q,"transparentMask","a"),Q=[],M.addLabelRange(Q,YQ("editor.uvoffset"),IQ("a","uvOffset"),iQ("a","uvOffset"),void 0,void 0,1,"number"),M.addNameRow(Q,"uvOffset","a"),Q=[],M.addLabelRange(Q,YQ("editor.uvscale"),IQ("a","uvScale"),iQ("a","uvScale"),void 0,void 0,1,"number"),M.addNameRow(Q,"uvScale","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.discardSelectable"),IQ("a","discardSelectable"),iQ("a","discardSelectable")),M.addNameRow(Q,"discardSelectable","a"),Q=[],M.addLabelRange(Q,YQ("editor.opacity"),IQ("a","opacity"),iQ("a","opacity"),0,1,.01,"number"),M.addNameRow(Q,"opacity","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.transparent"),IQ("a","transparent"),iQ("a","transparent")),M.addNameRow(Q,"transparent","a"),Q=[],M.addLabelCheckBox(Q,YQ("editor.autoSort"),IQ("a","autoSort"),iQ("a","autoSort")),M.addNameRow(Q,"autoSort","a"),M},Q.prototype.initAdvanceView=function(){return oQ({value:"",language:"json",theme:p.config.codeEditorTheme,readOnly:!1,minimap:{enabled:!1}})},Q.prototype.initButtons=function(){var M=this,Q=[];return Q.push({label:YQ("editor.ok"),action:function(){M._tabView.getTabModel().sm().ld()===M._advanceTab&&M.parseBatchInfo(JSON.parse(M._advanceView.getValue())),M.handleComplete(M.toBatchInfo()),M.hide()}}),Q.push({label:YQ("editor.cancel"),action:function(){M.hide()}}),Q},Q.prototype.toBatchInfo=function(){var M=TQ(this._commonView.data.getAttrObject());for(var Q in RQ){var b=RQ[Q];(M[Q]===b||void 0===b&&null===M[Q])&&delete M[Q]}return M},Q.prototype.parseBatchInfo=function(M){M=TQ(M);for(var Q in RQ)M.hasOwnProperty(Q)||(M[Q]=RQ[Q]);this._commonView.data.setAttrObject(M)},Q.prototype.handleComplete=function(M){console.info(M)},Q.prototype.show=function(){for(var Q,b=arguments.length,Y=Array(b),I=0;I<b;I++)Y[I]=arguments[I];(Q=M.prototype.show).call.apply(Q,[this].concat(Y)),this._commonView.filterProperties()},Q.prototype.hide=function(){this._commonView.data.setAttrObject({}),this._tabView.getTabModel().sm().ss(this._commonTab),M.prototype.hide.call(this)},Q}(ht.widget.Dialog),LQ=p.getString,GQ=function(){function I(M){var Q=this;S(this,I),this.params=M,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$38$=M.$38$;var b=ht.Default.getClass(hteditor.config.serviceClass||z);this.$39$=new b(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(M,b){Q.inspector&&Q.inspector.updateProperties()};var Y=this.serializer=new ht.JSONSerializer;Y.isSerializable=function(M){return Q.scene.sm().contains(M)};var i=this.serializer.getProperties;Y.getProperties=function(M){var Q=i.call(Y,M);return hteditor.config.cloneTag||delete Q.tag,Q},this.editable=!0}return I.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},I.prototype.removeEventListener=function(M,Q){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},I.prototype.fireEvent=function(M,Q){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},I.prototype.handleServiceEvent=function(I){if("connected"===I.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===I.type){var i=I.path;if(t(i)){var o=this.scene,T=o.getTextureMap();T[i]&&o.deleteTexture(i),o.invalidateAll(),this.gv.invalidateAll()}M(i)?this.requestScenes():Q(i)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):b(i)?this.requestSymbols():Y(i)&&this.requestAssets()}else"download"===I.type?this.downloadFile(I.path):"confirm"===I.type&&this.requestImport(I.path);this.fireEvent(I.type,I)},I.prototype.downloadFile=function(M){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},I.prototype.requestImport=function(M){hteditor.Editor.prototype.requestImport.apply(this,arguments)},I.prototype.beginTransaction=function(){this.dm.beginTransaction()},I.prototype.endTransaction=function(){this.dm.endTransaction()},I.prototype.init=function(){var M=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new r(this),this.rulerView=new A(this,this.gv),this.eventView=new hteditor.EventView(this),this.scene=new J(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.messageView=new hteditor.MessageView(this),this.mainToolbar=new $(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new u(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){M.topBorderPane.setRightWidth(M.rightToolbar.getSumWidth())},this.resetInteractionState(),this.mainTabView=new ht.widget.TabView,this.scenes=new n(this),this.models=new B(this),this.symbols=new V(this),this.assets=new k(this),this.leftTopTabView=new ht.widget.TabView,L(this.leftTopTabView,LQ("editor.scenes"),this.scenes,!0),L(this.leftTopTabView,LQ("editor.models"),this.models),L(this.leftTopTabView,LQ("editor.symbols"),this.symbols),L(this.leftTopTabView,LQ("editor.assets"),this.assets),this.treePane=new bQ(this),this.dataView=new a(this),this.rightBottomTabView=new ht.widget.TabView,L(this.rightBottomTabView,LQ("editor.list"),this.treePane,!0),L(this.rightBottomTabView,LQ("editor.data"),this.dataView),p.config.batchEditable&&(this.batchView=new CQ(this),L(this.rightBottomTabView,LQ("editor.batch"),this.batchView));var Q=this.rightBottomTabView.getTabModel().sm();Q.ms(function(){var b=Q.ld();M.dataView.visible=(b?b.getView():null)===M.dataView}),this.alignPane=new q(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$38$),this.$38$&&this.$38$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$38$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.scene.mi(this.handleSceneInteractive,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var b=this.params.open||G("hteditor")||hteditor.config.open;b&&(hteditor.isJSON(b)?this._pendingOpenJSON=b:"newscene"===b&&this.newScene()),this.reset()},I.prototype.initSID=function(){var M=window.location.href.match("sid=([0-9a-z-]*)");M&&(this.sid=M[1])},I.prototype.handleDataModelPropertyChange=function(M){this.inspector&&this.inspector.global&&this.inspector.$34$(M),this.dataView.$66$(M);var Q=this.scene,b=M.property,Y=M.newValue;if(null!=Y)if("a:sceneEditHelperDisabled"===b)Q.setEditHelperDisabled(Y),this.rightToolbar.iv();else if("a:sceneGridEnabled"===b)Q.setGridVisible(Y),Q.setOriginAxisVisible(Y),this.gv.getEditInteractor().gridEnabled=Y,this.rightToolbar.iv();else if("a:sceneGridBlockCount"===b)Q.setGridSize(Y);else if("a:sceneGridBlockSize"===b)Q.setGridGap(Y),this.gv.setEditStyle("gridBlockSize",Y);else if("a:sceneGridColor"===b){var I=ht.Default.toColorData(Y);Q.setGridColor([I[0]/255,I[1]/255,I[2]/255,1]),this.gv.setEditStyle("gridThickColor",Y),this.gv.setEditStyle("gridLightColor","rgba("+I[0]+", "+I[1]+", "+I[2]+", 0.4)")}else if("a:sceneNear"===b)Q.setNear(Y);else if("a:sceneFar"===b)Q.setFar(Y);else if("a:sceneBloom"===b)Q.setPostProcessingValue("Bloom","enable",Y);else if("a:sceneBloomStrength"===b)Q.setPostProcessingValue("Bloom","strength",Y);else if("a:sceneBloomThreshold"===b)Q.setPostProcessingValue("Bloom","threshold",Y);else if("a:sceneBloomRadius"===b)Q.setPostProcessingValue("Bloom","radius",Y);else if("a:sceneDof"===b)Q.setPostProcessingValue("Dof","enable",Y);else if("a:sceneDofAperture"===b)Q.setPostProcessingValue("Dof","aperture",Y);else if("a:sceneDofImage"===b)Q.setPostProcessingValue("Dof","image",Y);else if("a:sceneHighlightMode"===b)Q.setHighlightMode(Y);else if("a:sceneHighlightWidth"===b)Q.setHighlightWidth(Y);else if("a:sceneHighlightColor"===b)Q.setHighlightColor(Y);else if("a:sceneDashEnable"===b)Q.setDashDisabled(!Y);else if("a:sceneHeadlightEnable"===b)Q.setHeadlightDisabled(!Y);else if("a:sceneHeadlightRange"===b)Q.setHeadlightRange(Y);else if("a:sceneHeadlightColor"===b)Q.setHeadlightColor(Y);else if("a:sceneHeadlightIntensity"===b)Q.setHeadlightIntensity(Y);else if("a:sceneHeadlightAmbientIntensity"===b)Q.setHeadlightAmbientIntensity(Y);else if("a:sceneFogEnable"===b)Q.setFogDisabled(!Y);else if("a:sceneFogColor"===b)Q.setFogColor(Y);else if("a:sceneFogNear"===b)Q.setFogNear(Y);else if("a:sceneFogFar"===b)Q.setFogFar(Y);else if("a:sceneBatchBrightnessDisabled"===b)Q.setBatchBrightnessDisabled(Y);else if("a:sceneBatchBlendDisabled"===b)Q.setBatchBlendDisabled(Y);else if("a:sceneBatchColorDisabled"===b)Q.setBatchColorDisabled(Y);else if("a:sceneShadowEnabled"===b)Y?Q.enableShadow():Q.disableShadow();else if("a:sceneShadowDegreeX"===b)Q.setShadowDegreeX(Y);else if("a:sceneShadowDegreeZ"===b)Q.setShadowDegreeZ(Y);else if("a:sceneShadowIntensity"===b)Q.setShadowIntensity(Y);else if("a:sceneShadowQuality"===b)Q.setShadowQuality(Y);else if("a:sceneShadowType"===b)Q.setShadowType(Y);else if("a:sceneShadowRadius"===b)Q.setShadowRadius(Y);else if("a:sceneShadowBias"===b)Q.setShadowBias(Y);else if("a:sceneBatchInfoMap"===b){Q.setBatchInfoMap(Y);var i=this.batchView;i&&(i.parseBatchInfoMap(Y),i.updateProperties())}else"a:sceneOrthographic"===b&&this._setSceneOrtho(Y)},I.prototype._setSceneOrtho=function(M){var Q=this.scene,b=this.__updateEye__;b||(b=this.__updateEye__=function(){var M=new ht.Math.Vector3,b=new ht.Math.Vector3,Y=new ht.Math.Vector3;return function(I){if(I){M.fromArray(Q.getCenter()),b.fromArray(Q.getEye()),b.sub(M);var i=[0,1,0];"right"===I?i=[1,0,0]:"front"===I&&(i=[0,0,1]),Y.fromArray(i).setLength(b.length()).add(M),Q.setEye(Y.toArray())}}}());var Y=this.__defaultInteractor__;if(!Y)for(var I=Q.getInteractors(),i=0,o=I.length;i<o;i++){var T=I.get(0);if(T instanceof ht.graph3d.DefaultInteractor){Y=this.__defaultInteractor__=T;break}}var C=this.__orthoPanInteractor__;C||(C=this.__orthoPanInteractor__=new eM(Q)),Q.setOrtho(!!M),M?(Q.setInteractors([C]),b(M)):Q.setInteractors([Y])},I.prototype.handleScenelPropertyChange=function(M){this.inspector&&this.inspector.global&&this.inspector.$34$(M),this._sceneInteracting||this.dataView.$66$(M)},I.prototype.handleSceneInteractive=function(M){this._sceneInteracting="betweenRotate"===M.kind||"betweenPan"===M.kind,this._sceneInteracting||this.dataView.$66$(M)},I.prototype.handleDataModelChange=function(M){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.dataView.$66$(M)},I.prototype.handleDataPropertyChange=function(M){var Q=M.data;if("parent"===M.property&&Q instanceof ht.Node&&!ht.Default.isIsolating()){var b=Q.getParent();b instanceof ht.Block&&(b=null),(!b||b instanceof ht.Node)&&Q.setHost(b)}this.inspector&&!this.inspector.global&&this.inspector.data===Q&&this.inspector.$34$(M),this.dataView.$66$(M)},I.prototype.handleSelectionChange=function(){this.updateInspector()},I.prototype.handleInteractor=function(M){"selectPoint"===M.kind&&(this.currentPoint=void 0===M.x?null:{x:M.x,y:M.y,e:M.e},this.updateInspector())},I.prototype.updateInspector=function(){this.inspector=null;var M=this.ld;if(M){var Q=M.s("shape3d")
;M instanceof ht.Block?this.inspector=this.blockInspector:M instanceof ht.Polyline?this.inspector=this.polylineInspector:M instanceof ht.Shape?"cylinder"===Q?this.inspector=this.pipelineInspector:M.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:M instanceof ht.Node?Q?hteditor.isJSON(Q)?this.inspector=this.modelInspector:"billboard"===Q||"plane"===Q?this.inspector=this.billboardInspector:"cube"===Q?this.inspector=this.cubeInspector:"cone"===Q?this.inspector=this.coneInspector:"cylinder"===Q?this.inspector=this.cylinderInspector:"roundRect"===Q?this.inspector=this.roundRectInspector:"sphere"===Q?this.inspector=this.sphereInspector:"torus"===Q?this.inspector=this.torusInspector:"triangle"===Q&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:M instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=M,this.inspector.filterPropertiesLater()),this.rightTopBorderPane.setCenterView(this.inspector)},I.prototype.reset=function(M){M||(this.url=null);var Q=this.dm;Q.disableHistoryManager(),Q.setPostProcessingData(void 0),Q.setName(void 0),Q.setBackground(void 0),Q.setHierarchicalRendering(!0),Q.setLayers(void 0),Q.setAttrObject(void 0),Q.setEnvmap(void 0),Q.clear();var b=this.gv;b.setZoom(1),b.tx(0),b.ty(0);var Y=this.scene;Y.setEye(p.config.sceneEye),Y.setCenter(p.config.sceneCenter),Q.a("sceneNear",p.config.sceneNear),Q.a("sceneFar",p.config.sceneFar),Q.a("connectActionType",p.config.sceneConnectActionType),Q.a("sceneEditHelperDisabled",p.config.sceneEditHelperDisabled),Q.a("sceneGridEnabled",p.config.sceneGridEnabled),Q.a("sceneGridBlockCount",p.config.sceneGridBlockCount),Q.a("sceneGridBlockSize",p.config.sceneGridBlockSize),Q.a("sceneGridColor",p.config.sceneGridColor),Q.a("sceneBatchBrightnessDisabled",p.config.sceneBatchBrightnessDisabled),Q.a("sceneBatchBlendDisabled",p.config.sceneBatchBlendDisabled),Q.a("sceneBatchColorDisabled",p.config.sceneBatchColorDisabled),Q.a("sceneHighlightMode",p.config.sceneHighlightMode),Q.a("sceneHighlightColor",p.config.sceneHighlightColor),Q.a("sceneHighlightWidth",p.config.sceneHighlightWidth),Q.a("sceneDashEnable",p.config.sceneDashEnable),Q.a("sceneHeadlightEnable",p.config.sceneHeadlightEnable),Q.a("sceneHeadlightRange",p.config.sceneHeadlightRange),Q.a("sceneHeadlightColor",p.config.sceneHeadlightColor),Q.a("sceneHeadlightIntensity",p.config.sceneHeadlightIntensity),Q.a("sceneHeadlightAmbientIntensity",p.config.sceneHeadlightAmbientIntensity),Q.a("sceneFogEnable",p.config.sceneFogEnable),Q.a("sceneFogColor",p.config.sceneFogColor),Q.a("sceneFogNear",p.config.sceneFogNear),Q.a("sceneFogFar",p.config.sceneFogFar),Q.a("sceneShadowEnabled",p.config.sceneShadowEnabled),Q.a("sceneShadowDegreeX",p.config.sceneShadowDegreeX),Q.a("sceneShadowDegreeZ",p.config.sceneShadowDegreeZ),Q.a("sceneShadowIntensity",p.config.sceneShadowIntensity),Q.a("sceneShadowQuality",p.config.sceneShadowQuality),Q.a("sceneShadowType",p.config.sceneShadowType),Q.a("sceneShadowRadius",p.config.sceneShadowRadius),Q.a("sceneShadowBias",p.config.sceneShadowBias),Q.a("sceneDof",p.config.sceneDof),Q.a("sceneDofAperture",p.config.sceneDofAperture),Q.a("sceneDofImage",p.config.sceneDofImage),Q.a("sceneBloom",p.config.sceneBloom),Q.a("sceneBloomStrength",p.config.sceneBloomStrength),Q.a("sceneBloomThreshold",p.config.sceneBloomThreshold),Q.a("sceneBloomRadius",p.config.sceneBloomRadius),Q.a("sceneOrthographic",p.config.sceneOrthographic),this.batchView&&this.batchView.clearBatchInfo(),Q.enableHistoryManager(),Q.clearHistoryManager()},I.prototype.getModelDialog=function(M){var Q=this.modelDialogs[M];if(!Q){var b=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[M]:null;b||(b=NM),Q=this.modelDialogs[M]=new b(this)}return Q},I.prototype.open=function(M,Q){var b=this;if(ht.Default.isString(M)&&(M=this.getFileNode(M)),M&&!M.$33$){var Y=M.url;"scene"===M.fileType?this.newScene(Y):"model"===M.fileType&&ht.Default.xhrLoad(Y,function(M){M=ht.Default.parse(M),b.getModelDialog(M.modelType).open(Y,M)})}},I.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},I.prototype.newScene=function(M){M?(this.opened=!1,this.url=M,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},I.prototype.readForOld3dEditorFormat=function(M){var Q=this.dm,b=M.scene;if(b&&(b.near&&Q.a("sceneNear",b.near),b.far&&Q.a("sceneFar",b.far),null!=b.shadow&&b.shadowParams)){Q.a("sceneShadowEnabled",b.shadow);var Y=b.shadowParams;for(var I in Y){var i=Y[I];null!=i&&Q.a("sceneShadow"+I.charAt(0).toUpperCase()+I.substr(1),i)}}var o=Q.getPostProcessingData();if(o){Q.setPostProcessingData(void 0);var T=o.bloom;T&&(null!=T.enable&&Q.a("sceneBloom",T.enable),null!=T.strength&&Q.a("sceneBloomStrength",T.strength),null!=T.threshold&&Q.a("sceneBloomThreshold",T.threshold),null!=T.radius&&Q.a("sceneBloomRadius",T.radius));var C=o.dof;C&&(null!=C.enable&&Q.a("sceneDof",C.enable),null!=C.aperture&&Q.a("sceneDofAperture",C.aperture),null!=C.image&&Q.a("sceneDofImage",C.image))}},I.prototype.reload=function(){var M=this,Q=this.url;if(Q){this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:Q});var b=this.scene;this.reset(!0),this.dm.disableHistoryManager(),b.deserialize(Q,{setId:p.config.setId,finishFunc:function(b,Y){M.gv.fitContent(!0),M.readForOld3dEditorFormat(b);var I=b.scene;I&&(I.eye&&M.scene.setEye(I.eye),I.center&&M.scene.setCenter(I.center)),Y.setPostProcessingData(void 0),M.dm.enableHistoryManager(),M.dm.clearHistoryManager(),M.fireEvent(M.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:M,url:Q}),M.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0})}},I.prototype.save=function(){var M=this;if(this.url)this.saveImpl(this.url);else{var Q=this.scenes.currentDir,b=LQ("editor.inputnewscenename"),Y=function(b,Y){if("ok"===Y){var I=hteditor.isJSON(b)?hteditor.trimExtension(b):b,i=Q+"/"+I+".json",o=!1;if(M.scenes.dataModel.each(function(M){M.url===i&&(o=!0)}),o){var T=[{label:LQ("editor.ok"),action:function(){C.hide()}}],C=new ht.widget.Dialog({title:LQ("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+i+"</p>",buttons:T});C.show()}else M.saveImpl(i)}},I={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",I),I.name?Y(I.name,"ok"):hteditor.getInput(b,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},Y)}},I.prototype.saveImpl=function(M){var Q=this;if(M){this.url=M;var b={url:M,scene:this.scene};if(this.fireEvent("sceneSaving",b),b.preventDefault)return!1;b={path:b.url,content:this.serialize()},this.request("upload",b,function(Y){!0===Y&&(Q.fireEvent("sceneSaved",b),Q.messageView.show(LQ("editor.savedsuccessfully")),b={path:M.substr(0,M.length-5)+".png",content:Q.scene.toImage(Q.dm.getBackground())},Q.request("upload",b,function(b){!0===b&&Q.selectFileNode(M)}))})}},I.prototype.preview=function(){var M=this.dm.a("previewURL")||"scene.html";this.url&&-1===M.indexOf("?")&&(M+="?tag="+encodeURI(this.url));var Q={url:M};this.fireEvent("sceneViewPreviewing",Q),window.open(Q.url,Q.url),Q={path:"previews/scene.json",content:this.serialize()},this.request("upload",Q,function(M){})},I.prototype.deserialize=function(M){this.scene.deserialize(M,function(M,Q,b){})},I.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},I.prototype.toJSON=function(){var M=this.dm,Q=M.toJSON(),b={},Y=ht.Default.clone(this.scene.getEye());Y.join(",")!==p.config.sceneEye.join(",")&&(b.eye=Y);var I=ht.Default.clone(this.scene.getCenter());I.join(",")!==p.config.sceneCenter.join(",")&&(b.center=I),ht.Default.isEmptyObject(b)||(Q.scene=b);var i=this.scene.getBatchInfoMap();return ht.Default.isEmptyObject(i)||(Q.a.sceneBatchInfoMap=i),M.a("sceneNear")===p.config.sceneNear&&delete Q.a.sceneNear,M.a("sceneFar")===p.config.sceneFar&&delete Q.a.sceneFar,M.a("sceneEditHelperDisabled")===p.config.sceneEditHelperDisabled&&delete Q.a.sceneEditHelperDisabled,M.a("sceneGridEnabled")===p.config.sceneGridEnabled&&delete Q.a.sceneGridEnabled,M.a("sceneGridBlockCount")===p.config.sceneGridBlockCount&&delete Q.a.sceneGridBlockCount,M.a("sceneGridBlockSize")===p.config.sceneGridBlockSize&&delete Q.a.sceneGridBlockSize,M.a("sceneGridColor")===p.config.sceneGridColor&&delete Q.a.sceneGridColor,M.a("sceneBatchBrightnessDisabled")===p.config.sceneBatchBrightnessDisabled&&delete Q.a.sceneBatchBrightnessDisabled,M.a("sceneBatchBlendDisabled")===p.config.sceneBatchBlendDisabled&&delete Q.a.sceneBatchBlendDisabled,M.a("sceneBatchColorDisabled")===p.config.sceneBatchColorDisabled&&delete Q.a.sceneBatchColorDisabled,M.a("sceneHighlightMode")===p.config.sceneHighlightMode&&delete Q.a.sceneHighlightMode,M.a("sceneHighlightColor")===p.config.sceneHighlightColor&&delete Q.a.sceneHighlightColor,M.a("sceneHighlightWidth")===p.config.sceneHighlightWidth&&delete Q.a.sceneHighlightWidth,M.a("sceneDashEnable")===p.config.sceneDashEnable&&delete Q.a.sceneDashEnable,M.a("sceneHeadlightEnable")===p.config.sceneHeadlightEnable&&delete Q.a.sceneHeadlightEnable,M.a("sceneHeadlightRange")===p.config.sceneHeadlightRange&&delete Q.a.sceneHeadlightRange,M.a("sceneHeadlightColor")===p.config.sceneHeadlightColor&&delete Q.a.sceneHeadlightColor,M.a("sceneHeadlightIntensity")===p.config.sceneHeadlightIntensity&&delete Q.a.sceneHeadlightIntensity,M.a("sceneHeadlightAmbientIntensity")===p.config.sceneHeadlightAmbientIntensity&&delete Q.a.sceneHeadlightAmbientIntensity,M.a("sceneFogEnable")===p.config.sceneFogEnable&&delete Q.a.sceneFogEnable,M.a("sceneFogColor")===p.config.sceneFogColor&&delete Q.a.sceneFogColor,M.a("sceneFogNear")===p.config.sceneFogNear&&delete Q.a.sceneFogNear,M.a("sceneFogFar")===p.config.sceneFogFar&&delete Q.a.sceneFogFar,M.a("sceneFogMode")===p.config.sceneFogMode&&delete Q.a.sceneFogMode,M.a("sceneFogDensity")===p.config.sceneFogDensity&&delete Q.a.sceneFogDensity,M.a("sceneShadowEnabled")===p.config.sceneShadowEnabled&&delete Q.a.sceneShadowEnabled,M.a("sceneShadowDegreeX")===p.config.sceneShadowDegreeX&&delete Q.a.sceneShadowDegreeX,M.a("sceneShadowDegreeZ")===p.config.sceneShadowDegreeZ&&delete Q.a.sceneShadowDegreeZ,M.a("sceneShadowIntensity")===p.config.sceneShadowIntensity&&delete Q.a.sceneShadowIntensity,M.a("sceneShadowQuality")===p.config.sceneShadowQuality&&delete Q.a.sceneShadowQuality,M.a("sceneShadowType")===p.config.sceneShadowType&&delete Q.a.sceneShadowType,M.a("sceneShadowRadius")===p.config.sceneShadowRadius&&delete Q.a.sceneShadowRadius,M.a("sceneShadowBias")===p.config.sceneShadowBias&&delete Q.a.sceneShadowBias,M.a("sceneDof")===p.config.sceneDof&&delete Q.a.sceneDof,M.a("sceneDofAperture")===p.config.sceneDofAperture&&delete Q.a.sceneDofAperture,M.a("sceneDofImage")===p.config.sceneDofImage&&delete Q.a.sceneDofImage,M.a("sceneBloom")===p.config.sceneBloom&&delete Q.a.sceneBloom,M.a("sceneBloomStrength")===p.config.sceneBloomStrength&&delete Q.a.sceneBloomStrength,M.a("sceneBloomThreshold")===p.config.sceneBloomThreshold&&delete Q.a.sceneBloomThreshold,M.a("sceneBloomRadius")===p.config.sceneBloomRadius&&delete Q.a.sceneBloomRadius,Q},I.prototype.$3$=function(){return this._interactionState},I.prototype.$4$=function(M,Q){var b=this;if(this._interactionState!==M){this._interactionState=M,this.pointsEditingMode=!1;var Y=[];this.gv.getInteractors().each(function(Q){Q.keep?Q.interactiveDisabled="edit"!==M:Y.push(Q)}),Y.forEach(function(M){M.tearDown(),b.gv.getInteractors().remove(M)}),"edit"!==M&&(Q.setUp(),this.gv.getInteractors().add(Q)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},I.prototype.request=function(M,Q,b,Y){var I=this;b=b||s,Y?setTimeout(function(){I.$39$.request(M,Q,b)},Y):this.$39$.request(M,Q,b)},I.prototype.requestScenes=function(){var Q=this;this._requestingScenes||(this.request("explore","/scenes",function(b){Q._requestingScenes=!1,Q.scenes.parse(b),Q._pendingOpenJSON&&M(Q._pendingOpenJSON)&&(Q.scenes.dataModel.getDataById(Q._pendingOpenJSON)?(Q.open(Q._pendingOpenJSON),Q.selectFileNode(Q._pendingOpenJSON)):p.config.newIfFailToOpen&&(Q.newScene(),Q.url=Q._pendingOpenJSON,Q.save()),delete Q._pendingOpenJSON),Q._pendingSelectURL&&M(Q._pendingSelectURL)&&Q.selectFileNode(Q._pendingSelectURL)},hteditor.config.requestDelay),this._requestingScenes=!0)},I.prototype.requestSymbols=function(){hteditor.Editor.prototype.requestSymbols.apply(this,arguments)},I.prototype.requestModels=function(){hteditor.Editor.prototype.requestModels.apply(this,arguments)},I.prototype.requestAssets=function(){hteditor.Editor.prototype.requestAssets.apply(this,arguments)},I.prototype.requestBase64=function(M,Q){this.request("source",{url:M,encoding:"base64",prefix:"data:;base64,"},Q)},I.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm();var M=this.serializer.toJSON();delete M.p,delete M.a,this._cloneJSON=ht.Default.stringify(M)}},I.prototype.paste=function(){if(this._cloneJSON){var M=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(M)}},I.prototype.hasCopyInfo=function(){return!!this._cloneJSON},I.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},I.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},I.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},I.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},I.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},I.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},I.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},I.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},I.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},I.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},I.prototype.fitSelection=function(){var M=this.dm.sm().getSelection();0===M.length&&(M=null),this.zoomToFit(M)},I.prototype.$48$=function(M){hteditor.Editor.prototype.$48$.apply(this,arguments)},I.prototype.$47$=function(M){hteditor.Editor.prototype.$47$.apply(this,arguments)},I.prototype.handleKeydown=function(M){hteditor.Editor.prototype.handleKeydown.apply(this,arguments)},I.prototype.selectFileNode=function(M){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},I.prototype.dropLocalFileOnDir=function(M,Q){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},I.prototype.uploadLocalFile=function(M,Q){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},I.prototype.zoomIn=function(){this.gv&&this.gv.zoomIn(p.config.animate),this.scene&&this.scene.zoomIn(p.config.animate)},I.prototype.zoomOut=function(){this.gv&&this.gv.zoomOut(p.config.animate),this.scene&&this.scene.zoomOut(p.config.animate)},I.prototype.zoomToFit=function(M){this.scene.flyTo(M,{animation:p.config.animate});var Q=this.gv;if(!M)return void Q.fitContent(p.config.animate,p.config.fitPadding);var b;M.each(function(M){b=ht.Default.unionRect(b,Q.getDataUIBounds(M))}),ht.Default.grow(b,20,20),Q.fitRect(b,p.config.animate)},I.prototype.zoomReset=function(){this.gv&&this.gv.zoomReset(p.config.animate),this.scene&&this.scene.isResettable()&&this.scene.reset()},I.prototype.saveImage=function(){hteditor.Editor.prototype.saveImage.apply(this,arguments)},I.prototype.createSceneItem=function(M,Q,b,Y){var I=this,i=function(){return I.$3$()===M},o=hteditor.createItem(M,Q,b,i);return o.action=function(){I.$4$(M,Y)},o},I.prototype.resetInteractionState=function(){this.$4$("edit")},I.prototype.isRulerEnabled=function(){return this.rulerView.isRulerEnabled()},I.prototype.setRulerEnabled=function(M){this.rulerView.setRulerEnabled(M)},I.prototype.toggleRulerEnabled=function(){this.setRulerEnabled(!this.isRulerEnabled())},I.prototype.block=function(){if(this.editable){var M=this.dm.sm().getSelection();if(M.length){this.beginTransaction();var Q=new ht.Block;M.forEach(function(M){M.setParent(Q)}),this.dm.add(Q),this.endTransaction()}}},I.prototype.unblock=function(){var M=this;if(this.editable){this.beginTransaction();var Q=[];this.sm.toSelection().each(function(b){if(b instanceof ht.Block&&!(b instanceof ht.RefGraph)){var Y=b.getParent();b.getChildren().toArray().forEach(function(M){M.setParent(Y),Q.push(M)}),M.dm.remove(b)}}),Q.length&&this.sm.ss(Q),this.endTransaction()}},I.prototype.bringToFront=function(){},I.prototype.sendToBack=function(){},I.prototype.bringForward=function(){},I.prototype.sendBackward=function(){},Z(I,[{key:"url",get:function(){return this._url},set:function(M){this._url=M,this.dataView.updateUrl()}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}},{key:"dir",get:function(){return this.explorer?this.explorer.tree.getSelectionModel().getLastData():null}},{key:"file",get:function(){return this.explorer?this.explorer.getFileListView().getSelectionModel().getLastData():null}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(M){this.editInteractor.pointsEditingMode=M}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(M){this.editInteractor.setStyle("anchorVisible",M)}},{key:"sceneInspector",get:function(){return this._sceneInspector||(this._sceneInspector=new x(this)),this._sceneInspector}},{key:"dataInspector",get:function(){return this._dataInspector||(this._dataInspector=new v(this)),this._dataInspector}},{key:"cubeInspector",get:function(){return this._cubeInspector||(this._cubeInspector=new TM(this)),this._cubeInspector}},{key:"coneInspector",get:function(){return this._coneInspector||(this._coneInspector=new CM(this)),this._coneInspector}},{key:"cylinderInspector",get:function(){return this._cylinderInspector||(this._cylinderInspector=new SM(this)),this._cylinderInspector}},{key:"roundRectInspector",get:function(){return this._roundRectInspector||(this._roundRectInspector=new ZM(this)),this._roundRectInspector}},{key:"sphereInspector",get:function(){return this._sphereInspector||(this._sphereInspector=new zM(this)),this._sphereInspector}},{key:"torusInspector",get:function(){return this._torusInspector||(this._torusInspector=new nM(this)),this._torusInspector}},{key:"triangleInspector",get:function(){return this._triangleInspector||(this._triangleInspector=new BM(this)),this._triangleInspector}},{key:"modelInspector",get:function(){return this._modelInspector||(this._modelInspector=new kM(this)),this._modelInspector}},{key:"billboardInspector",get:function(){return this._billboardInspector||(this._billboardInspector=new lM(this)),this._billboardInspector}},{key:"wallInspector",get:function(){return this._wallInspector||(this._wallInspector=new mM(this)),this._wallInspector}},{key:"floorInspector",get:function(){return this._floorInspector||(this._floorInspector=new $M(this)),this._floorInspector}},{key:"pipelineInspector",get:function(){return this._pipelineInspector||(this._pipelineInspector=new gM(this)),this._pipelineInspector}},{key:"polylineInspector",get:function(){return this._polylineInspector||(this._polylineInspector=new JM(this)),this._polylineInspector}},{key:"edgeInspector",get:function(){return this._edgeInspector||(this._edgeInspector=new qM(this)),this._edgeInspector}},{key:"blockInspector",get:function(){return this._blockInspector||(this._blockInspector=new vM(this)),this._blockInspector}},{key:"selection",get:function(){var M=this,Q=[];return this.gv&&this.gv.each(function(b){M.gv.isSelected(b)&&Q.push(b)}),Q}}]),I}();return p.version="0.3.10",p.config.logEditorInfo&&console.log("HT 3D Editor v0.3.10 powered by HT for Web v"+ht.Default.getVersion()+" from www.hightopo.com"),p.createEditor3d=function(M){if(window.location.host.indexOf("hightopo")>=0){var Q="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+Q+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}M&&(ht.Default.isString(M)?M={container:M}:M.tagName&&M.appendChild&&(M={container:M})),M=M||{};var b=void 0,Y=void 0===M.container?p.config.container:M.container;return null===Y?b=null:Y?ht.Default.isString(Y)?b=document.getElementById(Y):Y.length?(b=ht.Default.createDiv(),b.style.left=Y[0]+"px",b.style.top=Y[1]+"px",b.style.width=Y[2]+"px",b.style.height=Y[3]+"px",document.body.appendChild(b)):b=Y:b=document.body,M.$38$=b,new GQ(M)},p.config.valueTypes||(p.config.valueTypes={}),p.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},p}();